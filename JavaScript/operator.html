<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>operator 操作器 - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#JavaScript">JavaScript</a>&nbsp;&#187;&nbsp;operator 操作器
    <span class="updated">Page Updated&nbsp;
      2018-06-24 20:55
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">operator 操作器</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#dom">操作DOM</a><ul>
<li><a href="#texthtml">修改Text和HTML</a></li>
<li><a href="#css">修改CSS</a><ul>
<li><a href="#css_1">操作CSS属性</a></li>
</ul>
</li>
<li><a href="#dom_1">显示和隐藏DOM</a></li>
<li><a href="#dom_2">获取DOM信息</a></li>
<li><a href="#_1">操作表单</a></li>
<li><a href="#dom_3">修改DOM结构</a><ul>
<li><a href="#dom_4">添加DOM</a><ul>
<li><a href="#append">append() 方法</a></li>
<li><a href="#prepend">prepend() 方法</a></li>
</ul>
</li>
<li><a href="#_2">删除节点</a></li>
</ul>
</li>
<li><a href="#jquerydom">编写jQuery插件操作DOM</a><ul>
<li><a href="#jquery">编写一个jQuery插件的原则：</a></li>
<li><a href="#_3">针对特定元素的扩展</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="dom">操作DOM</h1>
<h2 id="texthtml">修改Text和HTML</h2>
<p>jQuery对象的<code>text()</code>和<code>html()</code>方法分别获取节点的文本和原始HTML文本，例如，如下的HTML结构：</p>
<div class="hlcode"><pre><span class="c">&lt;!-- HTML结构 --&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;test-ul&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;js&quot;</span><span class="nt">&gt;</span>JavaScript<span class="nt">&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">name=</span><span class="s">&quot;book&quot;</span><span class="nt">&gt;</span>Java <span class="ni">&amp;amp;</span> JavaScript<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>


<p>分别获取文本和HTML：</p>
<div class="hlcode"><pre><span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">ul</span> <span class="n">li</span><span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="n">book</span><span class="p">]</span><span class="err">&#39;</span><span class="p">).</span><span class="n">text</span><span class="p">();</span> <span class="c1">// &#39;Java &amp; JavaScript&#39;</span>
<span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">ul</span> <span class="n">li</span><span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="n">book</span><span class="p">]</span><span class="err">&#39;</span><span class="p">).</span><span class="n">html</span><span class="p">();</span> <span class="c1">// &#39;Java &amp;amp; JavaScript&#39;</span>
</pre></div>


<p>如何设置文本或HTML？jQuery的API设计非常巧妙：无参数调用<code>text()</code>是获取文本，传入参数就变成设置文本，HTML也是类似操作</p>
<div class="hlcode"><pre><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="n">j1</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-ul li.js&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="n">j2</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-ul li[name=book]&#39;</span><span class="p">);</span>

<span class="nx">j1.html</span><span class="p">(</span><span class="s1">&#39;&lt;span style=&quot;color: red&quot;&gt;JavaScript&lt;/span&gt;&#39;</span><span class="p">);</span>
<span class="nx">j2.text</span><span class="p">(</span><span class="s1">&#39;JavaScript &amp; ECMAScript&#39;</span><span class="p">);</span>
</pre></div>


<p>一个jQuery对象可以包含0个或任意个DOM对象，它的方法实际上会作用在对应的每个DOM节点上。在上面的例子中试试：</p>
<div class="hlcode"><pre><span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">ul</span> <span class="n">li</span><span class="err">&#39;</span><span class="p">).</span><span class="n">text</span><span class="p">(</span><span class="err">&#39;</span><span class="n">JS</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// 是不是两个节点都变成了JS？</span>
</pre></div>


<p>所以jQuery对象的另一个好处是我们可以执行一个操作，作用在对应的一组DOM节点上。即使选择器没有返回任何DOM节点，调用jQuery对象的方法仍然不会报错：</p>
<div class="hlcode"><pre><span class="c1">// 如果不存在id为not-exist的节点：</span>
<span class="err">$</span><span class="p">(&#39;#</span><span class="k">not</span><span class="o">-</span><span class="n">exist</span><span class="p">&#39;).</span><span class="n">text</span><span class="p">(&#39;</span><span class="n">Hello</span><span class="p">&#39;);</span> <span class="c1">// 代码不报错，没有节点被设置为&#39;Hello&#39;</span>
</pre></div>


<p>这意味着jQuery帮你免去了许多<code>if</code>语句。</p>
<h2 id="css">修改CSS</h2>
<p>jQuery对象有“批量操作”的特点，这用于修改CSS实在是太方便了。考虑下面的HTML结构：</p>
<div class="hlcode"><pre><span class="c">&lt;!-- HTML结构 --&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">&quot;test-css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;lang dy&quot;</span><span class="nt">&gt;&lt;span&gt;</span>JavaScript<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;lang&quot;</span><span class="nt">&gt;&lt;span&gt;</span>Java<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;lang dy&quot;</span><span class="nt">&gt;&lt;span&gt;</span>Python<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;lang&quot;</span><span class="nt">&gt;&lt;span&gt;</span>Swift<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;lang dy&quot;</span><span class="nt">&gt;&lt;span&gt;</span>Scheme<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>


<p>要高亮显示动态语言，调用jQuery对象的<code>css('name', 'value')</code>方法，我们用一行语句实现：</p>
<div class="hlcode"><pre><span class="err">&#39;</span><span class="n">use</span> <span class="n">strict</span><span class="err">&#39;</span><span class="p">;</span>
<span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">css</span> <span class="n">li</span><span class="p">.</span><span class="n">dy</span><span class="o">&gt;</span><span class="n">span</span><span class="err">&#39;</span><span class="p">).</span><span class="n">css</span><span class="p">(</span><span class="err">&#39;</span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;#</span><span class="n">ffd351</span><span class="err">&#39;</span><span class="p">).</span><span class="n">css</span><span class="p">(</span><span class="err">&#39;</span><span class="n">color</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">red</span><span class="err">&#39;</span><span class="p">);</span>
</pre></div>


<blockquote>
<p><em>注意</em>，jQuery对象的所有方法都返回一个jQuery对象（可能是新的也可能是自身），这样我们可以进行链式调用，非常方便。</p>
</blockquote>
<h3 id="css_1">操作CSS属性</h3>
<p>jQuery对象的<code>css()</code>方法可以这么用：</p>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">div</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">div</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">div</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="err">&#39;</span><span class="n">color</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// &#39;#000033&#39;, 获取CSS属性</span>
<span class="n">div</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="err">&#39;</span><span class="n">color</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;#</span><span class="mi">336699</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// 设置CSS属性</span>
<span class="n">div</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="err">&#39;</span><span class="n">color</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;&#39;</span><span class="p">);</span> <span class="c1">// 清除CSS属性</span>
</pre></div>


<p>为了和JavaScript保持一致，CSS属性可以用<code>'background-color'</code>和<code>'backgroundColor'</code>两种格式。</p>
<p><code>css()</code>方法将作用于DOM节点的<code>style</code>属性，具有最高优先级。如果要修改<code>class</code>属性，可以用jQuery提供的下列方法：</p>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">div</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">div</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">div</span><span class="p">.</span><span class="n">hasClass</span><span class="p">(</span><span class="err">&#39;</span><span class="n">highlight</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// false， class是否包含highlight</span>
<span class="n">div</span><span class="p">.</span><span class="n">addClass</span><span class="p">(</span><span class="err">&#39;</span><span class="n">highlight</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// 添加highlight这个class</span>
<span class="n">div</span><span class="p">.</span><span class="n">removeClass</span><span class="p">(</span><span class="err">&#39;</span><span class="n">highlight</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// 删除highlight这个class</span>
</pre></div>


<p>分别用<code>css()</code>方法和<code>addClass()</code>方法高亮显示JavaScript：</p>
<p>```<br />
<!-- HTML结构 --><br />
<style><br />
.highlight {<br />
    color: #dd1144;<br />
    background-color: #ffd351;<br />
}<br />
</style></p>
<div id="test-highlight-css">
    <ul>
        <li class="py"><span>Python</span></li>
        <li class="js"><span>JavaScript</span></li>
        <li class="sw"><span>Swift</span></li>
        <li class="hk"><span>Haskell</span></li>
    </ul>
</div>

<p>'use strict';<br />
var div = $('#test-highlight-css');<br />
div.find("li[class=js]").addClass("highlight");//寫法一</p>
<p>div.find("li[class=js]").css("color","#dd1144").css("background-color","red");//寫法二</p>
<p>$("div li.js").css("color","#dd1144").css("background-color","red");//或者可以這樣寫<br />
 ```</p>
<h2 id="dom_1">显示和隐藏DOM</h2>
<p>要隐藏一个DOM，我们可以设置CSS的<code>display</code>属性为<code>none</code>，利用<code>css()</code>方法就可以实现。不过，要显示这个DOM就需要恢复原有的<code>display</code>属性，这就得先记下来原有的<code>display</code>属性到底是<code>block</code>还是<code>inline</code>还是别的值。</p>
<p>考虑到显示和隐藏DOM元素使用非常普遍，jQuery直接提供<code>show()</code>和<code>hide()</code>方法，我们不用关心它是如何修改<code>display</code>属性的，总之它能正常工作：</p>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">a</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">&#39;</span><span class="n">a</span><span class="p">[</span><span class="n">target</span><span class="o">=</span><span class="n">_blank</span><span class="p">]</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">a</span><span class="p">.</span><span class="n">hide</span><span class="p">();</span> <span class="c1">// 隐藏</span>
<span class="n">a</span><span class="p">.</span><span class="n">show</span><span class="p">();</span> <span class="c1">// 显示</span>
</pre></div>


<p><em>注意</em>，隐藏DOM节点并未改变DOM树的结构，它只影响DOM节点的显示。这和删除DOM节点是不同的。</p>
<h2 id="dom_2">获取DOM信息</h2>
<p>利用jQuery对象的若干方法，我们直接可以获取DOM的高宽等信息，而无需针对不同浏览器编写特定代码：</p>
<div class="hlcode"><pre><span class="c1">// 浏览器可视窗口大小:</span>
<span class="err">$</span><span class="p">(</span><span class="n">window</span><span class="p">).</span><span class="n">width</span><span class="p">();</span> <span class="c1">// 800</span>
<span class="err">$</span><span class="p">(</span><span class="n">window</span><span class="p">).</span><span class="n">height</span><span class="p">();</span> <span class="c1">// 600</span>

<span class="c1">// HTML文档大小:</span>
<span class="err">$</span><span class="p">(</span><span class="n">document</span><span class="p">).</span><span class="n">width</span><span class="p">();</span> <span class="c1">// 800</span>
<span class="err">$</span><span class="p">(</span><span class="n">document</span><span class="p">).</span><span class="n">height</span><span class="p">();</span> <span class="c1">// 3500</span>

<span class="c1">// 某个div的大小:</span>
<span class="k">var</span> <span class="n">div</span> <span class="o">=</span> <span class="err">$</span><span class="p">(&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">div</span><span class="p">&#39;);</span>
<span class="n">div</span><span class="p">.</span><span class="n">width</span><span class="p">();</span> <span class="c1">// 600</span>
<span class="n">div</span><span class="p">.</span><span class="n">height</span><span class="p">();</span> <span class="c1">// 300</span>
<span class="n">div</span><span class="p">.</span><span class="n">width</span><span class="p">(</span><span class="mh">400</span><span class="p">);</span> <span class="c1">// 设置CSS属性 width: 400px，是否生效要看CSS是否有效</span>
<span class="n">div</span><span class="p">.</span><span class="n">height</span><span class="p">(&#39;</span><span class="mh">200</span><span class="n">px</span><span class="p">&#39;);</span> <span class="c1">// 设置CSS属性 height: 200px，是否生效要看CSS是否有效</span>
</pre></div>


<p><code>attr()</code>和<code>removeAttr()</code>方法用于操作DOM节点的属性：</p>
<div class="hlcode"><pre><span class="c1">// &lt;div id=&quot;test-div&quot; name=&quot;Test&quot; start=&quot;1&quot;&gt;...&lt;/div&gt;</span>
<span class="kd">var</span> <span class="n">div</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-div&#39;</span><span class="p">);</span>
<span class="nx">div.attr</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">);</span> <span class="c1">// undefined, 属性不存在</span>
<span class="nx">div.attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// &#39;Test&#39;</span>
<span class="nx">div.attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello&#39;</span><span class="p">);</span> <span class="c1">// div的name属性变为&#39;Hello&#39;</span>
<span class="nx">div.removeAttr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// 删除name属性</span>
<span class="nx">div.attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// undefined</span>
</pre></div>


<p><code>prop()</code>方法和<code>attr()</code>类似，但是HTML5规定有一种属性在DOM节点中可以没有值，只有出现与不出现两种，例如：</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">input</span> <span class="n">id</span><span class="o">=</span><span class="s">&quot;test-radio&quot;</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;test&quot;</span> <span class="n">checked</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
</pre></div>


<p>等价于：</p>
<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">input</span> <span class="n">id</span><span class="o">=</span><span class="s">&quot;test-radio&quot;</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;radio&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;test&quot;</span> <span class="n">checked</span><span class="o">=</span><span class="s">&quot;checked&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
</pre></div>


<p><code>attr()</code>和<code>prop()</code>对于属性<code>checked</code>处理有所不同：</p>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">radio</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">radio</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">radio</span><span class="p">.</span><span class="n">attr</span><span class="p">(</span><span class="err">&#39;</span><span class="n">checked</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// &#39;checked&#39;</span>
<span class="n">radio</span><span class="p">.</span><span class="n">prop</span><span class="p">(</span><span class="err">&#39;</span><span class="n">checked</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// true</span>
</pre></div>


<p><code>prop()</code>返回值更合理一些。不过，用<code>is()</code>方法判断更好：</p>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">radio</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">radio</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">radio</span><span class="p">.</span><span class="n">is</span><span class="p">(</span><span class="err">&#39;</span><span class="o">:</span><span class="n">checked</span><span class="err">&#39;</span><span class="p">);</span> <span class="c1">// true</span>
</pre></div>


<p>类似的属性还有<code>selected</code>，处理时最好用<code>is(':selected')</code>。</p>
<h2 id="_1">操作表单</h2>
<p>对于表单元素，jQuery对象统一提供<code>val()</code>方法获取和设置对应的<code>value</code>属性：</p>
<div class="hlcode"><pre><span class="cm">/*</span>
<span class="cm">    &lt;input id=&quot;test-input&quot; name=&quot;email&quot; value=&quot;&quot;&gt;</span>
<span class="cm">    &lt;select id=&quot;test-select&quot; name=&quot;city&quot;&gt;</span>
<span class="cm">        &lt;option value=&quot;BJ&quot; selected&gt;Beijing&lt;/option&gt;</span>
<span class="cm">        &lt;option value=&quot;SH&quot;&gt;Shanghai&lt;/option&gt;</span>
<span class="cm">        &lt;option value=&quot;SZ&quot;&gt;Shenzhen&lt;/option&gt;</span>
<span class="cm">    &lt;/select&gt;</span>
<span class="cm">    &lt;textarea id=&quot;test-textarea&quot;&gt;Hello&lt;/textarea&gt;</span>
<span class="cm">*/</span>
<span class="kd">var</span>
    <span class="n">input</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-input&#39;</span><span class="p">),</span>
    <span class="k">select</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-select&#39;</span><span class="p">),</span>
    <span class="n">textarea</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-textarea&#39;</span><span class="p">);</span>

<span class="nx">input.val</span><span class="p">();</span> <span class="c1">// &#39;test&#39;</span>
<span class="nx">input.val</span><span class="p">(</span><span class="s1">&#39;abc@example.com&#39;</span><span class="p">);</span> <span class="c1">// 文本框的内容已变为abc@example.com</span>

<span class="k">select</span><span class="bp">.</span><span class="nx">val</span><span class="p">();</span> <span class="c1">// &#39;BJ&#39;</span>
<span class="k">select</span><span class="bp">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">);</span> <span class="c1">// 选择框已变为Shanghai</span>

<span class="nx">textarea.val</span><span class="p">();</span> <span class="c1">// &#39;Hello&#39;</span>
<span class="nx">textarea.val</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">);</span> <span class="c1">// 文本区域已更新为&#39;Hi&#39;</span>
</pre></div>


<p>可见，一个<code>val()</code>就统一了各种输入框的取值和赋值的问题。</p>
<h2 id="dom_3">修改DOM结构</h2>
<h3 id="dom_4">添加DOM</h3>
<h4 id="append">append() 方法</h4>
<ul>
<li><code>append()</code>把DOM添加到最后</li>
</ul>
<p>要添加新的DOM节点，除了通过jQuery的<code>html()</code>这种暴力方法外，还可以用<code>append()</code>方法，例如：</p>
<div class="hlcode"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;test-div&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="nt">&lt;li&gt;&lt;span&gt;</span>JavaScript<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;span&gt;</span>Python<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
        <span class="nt">&lt;li&gt;&lt;span&gt;</span>Swift<span class="nt">&lt;/span&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>如何向列表新增一个语言？首先要拿到<code>&lt;ul&gt;</code>节点：</p>
<div class="hlcode"><pre><span class="n">var</span> <span class="n">ul</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">div</span><span class="o">&gt;</span><span class="n">ul</span><span class="err">&#39;</span><span class="p">);</span>
</pre></div>


<p>然后，调用<code>append()</code>传入HTML片段：</p>
<div class="hlcode"><pre><span class="nx">ul.append</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&lt;span&gt;Haskell&lt;/span&gt;&lt;/li&gt;&#39;</span><span class="p">);</span>
</pre></div>


<p>除了接受字符串，<code>append()</code>还可以传入原始的DOM对象，jQuery对象和函数对象：</p>
<div class="hlcode"><pre><span class="c1">// 创建DOM对象:</span>
<span class="kd">var</span> <span class="n">ps</span> <span class="o">=</span> <span class="nx">document.createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">);</span>
<span class="n">ps.innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;span&gt;Pascal&lt;/span&gt;&#39;</span><span class="p">;</span>
<span class="c1">// 添加DOM对象:</span>
<span class="nx">ul.append</span><span class="p">(</span><span class="nx">ps</span><span class="p">);</span>

<span class="c1">// 添加jQuery对象:</span>
<span class="nx">ul.append</span><span class="p">(</span><span class="err">$</span><span class="p">(</span><span class="s1">&#39;#scheme&#39;</span><span class="p">));</span>

<span class="c1">// 添加函数对象:</span>
<span class="nx">ul.append</span><span class="p">(</span><span class="nx">function</span> <span class="p">(</span><span class="nb">index</span><span class="p">,</span> <span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;&lt;li&gt;&lt;span&gt;Language - &#39;</span> <span class="o">+</span> <span class="nb">index</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt;&lt;/li&gt;&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>


<p>传入函数时，要求返回一个字符串、DOM对象或者jQuery对象。因为jQuery的<code>append()</code>可能作用于一组DOM节点，只有传入函数才能针对每个DOM生成不同的子节点。</p>
<h4 id="prepend">prepend() 方法</h4>
<ul>
<li><code>prepend()</code>则把DOM添加到最前</li>
</ul>
<p>如果要添加的DOM节点已经存在于HTML文档中，它会首先从文档移除，然后再添加，也就是说，用<code>append()</code>，你可以移动一个DOM节点。</p>
<p>如果要把新节点插入到指定位置，例如，JavaScript和Python之间，那么，可以先定位到JavaScript，然后用<code>after()</code>方法：</p>
<div class="hlcode"><pre><span class="kd">var</span> <span class="n">js</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-div&gt;ul&gt;li:first-child&#39;</span><span class="p">);</span>
<span class="nx">js.after</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;&lt;span&gt;Lua&lt;/span&gt;&lt;/li&gt;&#39;</span><span class="p">);</span>
</pre></div>


<p>也就是说，同级节点可以用<code>after()</code>或者<code>before()</code>方法。</p>
<h3 id="_2">删除节点</h3>
<p>要删除DOM节点，拿到jQuery对象后直接调用<code>remove()</code>方法就可以了。如果jQuery对象包含若干DOM节点，实际上可以一次删除多个DOM节点：</p>
<div class="hlcode"><pre><span class="kd">var</span> <span class="n">li</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="s1">&#39;#test-div&gt;ul&gt;li&#39;</span><span class="p">);</span>
<span class="nx">li.remove</span><span class="p">();</span> <span class="c1">// 所有&lt;li&gt;全被删除</span>
</pre></div>


<h2 id="jquerydom">编写jQuery插件操作DOM</h2>
<p>给jQuery对象绑定一个新方法是通过扩展<code>$.fn</code>对象实现的。让我们来编写第一个扩展——<code>highlight1()</code>：</p>
<div class="hlcode"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">highlight1</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// this已绑定为当前jQuery对象:</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">,</span> <span class="s1">&#39;#fffceb&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;#d85030&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>注意到函数内部的<code>this</code>在调用时被绑定为jQuery对象，所以函数内部代码可以正常调用所有jQuery对象的方法。</p>
<p>对于如下的HTML结构：</p>
<div class="hlcode"><pre><span class="c">&lt;!-- HTML结构 --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;test-highlight1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>什么是<span class="nt">&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;</span>是目前最流行的<span class="nt">&lt;span&gt;</span>JavaScript<span class="nt">&lt;/span&gt;</span>库。<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<div class="hlcode"><pre><span class="err">&#39;</span><span class="n">use</span> <span class="n">strict</span><span class="err">&#39;</span><span class="p">;</span>
<span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">highlight1</span> <span class="n">span</span><span class="err">&#39;</span><span class="p">).</span><span class="n">highlight1</span><span class="p">();</span>
</pre></div>


<p><img alt="alt" src="https://cdn.pbrd.co/images/Hs1eBTe.png" /></p>
<p>细心的童鞋可能发现了，为什么最后要<code>return this;</code>？因为jQuery对象支持链式操作，我们自己写的扩展方法也要能继续链式下去：</p>
<div class="hlcode"><pre><span class="err">$</span><span class="p">(</span><span class="err">&#39;</span><span class="n">span</span><span class="p">.</span><span class="n">hl</span><span class="err">&#39;</span><span class="p">).</span><span class="n">highlight1</span><span class="p">().</span><span class="n">slideDown</span><span class="p">();</span>
</pre></div>


<p>不然，用户调用的时候，就不得不把上面的代码拆成两行。</p>
<p>但是这个版本并不完美。有的用户希望高亮的颜色能自己来指定，怎么办？</p>
<p>我们可以给方法加个参数，让用户自己把参数用对象传进去。于是我们有了第二个版本的<code>highlight2()</code>：</p>
<div class="hlcode"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">highlight2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 要考虑到各种情况:</span>
    <span class="c1">// options为undefined</span>
    <span class="c1">// options只有部分key</span>
    <span class="kd">var</span> <span class="nx">bgcolor</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">||</span> <span class="s1">&#39;#fffceb&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">color</span> <span class="o">||</span> <span class="s1">&#39;#d85030&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">,</span> <span class="nx">bgcolor</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>对于如下HTML结构：</p>
<div class="hlcode"><pre><span class="c">&lt;!-- HTML结构 --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;test-highlight2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>什么是<span class="nt">&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span&gt;</span>Plugin<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>编写<span class="nt">&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span&gt;</span>Plugin<span class="nt">&lt;/span&gt;</span>可以用来扩展<span class="nt">&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;</span>的功能。<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<div class="hlcode"><pre><span class="err">&#39;</span><span class="n">use</span> <span class="n">strict</span><span class="err">&#39;</span><span class="p">;</span>
<span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">highlight2</span> <span class="n">span</span><span class="err">&#39;</span><span class="p">).</span><span class="n">highlight2</span><span class="p">({</span>
    <span class="nl">backgroundColor:</span> <span class="err">&#39;#</span><span class="mo">00</span><span class="n">a8e6</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">color:</span> <span class="err">&#39;#</span><span class="n">ffffff</span><span class="err">&#39;</span>
<span class="p">});</span>
</pre></div>


<p><img alt="alt" src="https://cdn.pbrd.co/images/Hs1fhAL.png" /></p>
<p>对于默认值的处理，我们用了一个简单的<code>&amp;&amp;</code>和<code>||</code>短路操作符，总能得到一个有效的值。</p>
<p>另一种方法是使用jQuery提供的辅助方法<code>$.extend(target, obj1, obj2, ...)</code>，它把多个object对象的属性合并到第一个target对象中，遇到同名属性，总是使用靠后的对象的值，也就是越往后优先级越高：</p>
<div class="hlcode"><pre><span class="c1">// 把默认值和用户传入的options合并到对象{}中并返回:</span>
<span class="k">var</span> <span class="n">opts</span> <span class="o">=</span> <span class="err">$</span><span class="p">.</span><span class="n">extend</span><span class="p">({},</span> <span class="p">{</span>
    <span class="nl">backgroundColor:</span> <span class="p">&#39;#</span><span class="mh">00</span><span class="n">a8e6</span><span class="p">&#39;,</span>
    <span class="nl">color:</span> <span class="p">&#39;#</span><span class="n">ffffff</span><span class="p">&#39;</span>
<span class="p">},</span> <span class="n">options</span><span class="p">);</span>
</pre></div>


<p>紧接着用户对<code>highlight2()</code>提出了意见：每次调用都需要传入自定义的设置，能不能让我自己设定一个缺省值，以后的调用统一使用无参数的<code>highlight2()</code>？</p>
<p>也就是说，我们设定的默认值应该能允许用户修改。</p>
<p>那默认值放哪比较合适？放全局变量肯定不合适，最佳地点是<code>$.fn.highlight2</code>这个函数对象本身。</p>
<p>于是最终版的<code>highlight()</code>终于诞生了：</p>
<div class="hlcode"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 合并默认值和用户设定值:</span>
    <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">highlight</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">backgroundColor</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 设定默认值:</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">highlight</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#d85030&#39;</span><span class="p">,</span>
    <span class="nx">backgroundColor</span><span class="o">:</span> <span class="s1">&#39;#fff8de&#39;</span>
<span class="p">}</span>
</pre></div>


<p>这次用户终于满意了。用户使用时，只需一次性设定默认值：</p>
<div class="hlcode"><pre><span class="err">$</span><span class="p">.</span><span class="n">fn</span><span class="p">.</span><span class="n">highlight</span><span class="p">.</span><span class="n">defaults</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="err">&#39;#</span><span class="n">fff</span><span class="err">&#39;</span><span class="p">;</span>
<span class="err">$</span><span class="p">.</span><span class="n">fn</span><span class="p">.</span><span class="n">highlight</span><span class="p">.</span><span class="n">defaults</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="err">&#39;#</span><span class="mo">000</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>然后就可以非常简单地调用<code>highlight()</code>了。</p>
<p>对如下的HTML结构：</p>
<div class="hlcode"><pre><span class="c">&lt;!-- HTML结构 --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;test-highlight&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>如何编写<span class="nt">&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span&gt;</span>Plugin<span class="nt">&lt;/span&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>编写<span class="nt">&lt;span&gt;</span>jQuery<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span&gt;</span>Plugin<span class="nt">&lt;/span&gt;</span>，要设置<span class="nt">&lt;span&gt;</span>默认值<span class="nt">&lt;/span&gt;</span>，并允许用户修改<span class="nt">&lt;span&gt;</span>默认值<span class="nt">&lt;/span&gt;</span>，或者运行时传入<span class="nt">&lt;span&gt;</span>其他值<span class="nt">&lt;/span&gt;</span>。<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<div class="hlcode"><pre><span class="err">&#39;</span><span class="n">use</span> <span class="n">strict</span><span class="err">&#39;</span><span class="p">;</span>
<span class="err">$</span><span class="p">.</span><span class="n">fn</span><span class="p">.</span><span class="n">highlight</span><span class="p">.</span><span class="n">defaults</span><span class="p">.</span><span class="n">color</span> <span class="o">=</span> <span class="err">&#39;#</span><span class="mf">659f</span><span class="mi">13</span><span class="err">&#39;</span><span class="p">;</span>
<span class="err">$</span><span class="p">.</span><span class="n">fn</span><span class="p">.</span><span class="n">highlight</span><span class="p">.</span><span class="n">defaults</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="err">&#39;#</span><span class="n">f2fae3</span><span class="err">&#39;</span><span class="p">;</span>

<span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">highlight</span> <span class="n">p</span><span class="o">:</span><span class="n">first</span><span class="o">-</span><span class="n">child</span> <span class="n">span</span><span class="err">&#39;</span><span class="p">).</span><span class="n">highlight</span><span class="p">();</span>

<span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">test</span><span class="o">-</span><span class="n">highlight</span> <span class="n">p</span><span class="o">:</span><span class="n">last</span><span class="o">-</span><span class="n">child</span> <span class="n">span</span><span class="err">&#39;</span><span class="p">).</span><span class="n">highlight</span><span class="p">({</span>
    <span class="nl">color:</span> <span class="err">&#39;#</span><span class="n">dd1144</span><span class="err">&#39;</span>
<span class="p">});</span>
</pre></div>


<p><img alt="alt" src="https://cdn.pbrd.co/images/Hs1fZ9a.png" /></p>
<h3 id="jquery">编写一个jQuery插件的原则：</h3>
<ol>
<li>给<code>$.fn</code>绑定函数，实现插件的代码逻辑；</li>
<li>插件函数最后要<code>return this;</code>以支持链式调用；</li>
<li>插件函数要有默认值，绑定在<code>$.fn.&lt;pluginName&gt;.defaults</code>上；</li>
<li>用户在调用时可传入设定值以便覆盖默认值。</li>
</ol>
<h3 id="_3">针对特定元素的扩展</h3>
<p>我们知道jQuery对象的有些方法只能作用在特定DOM元素上，比如<code>submit()</code>方法只能针对<code>form</code>。如果我们编写的扩展只能针对某些类型的DOM元素，应该怎么写？</p>
<p>还记得jQuery的选择器支持<code>filter()</code>方法来过滤吗？我们可以借助这个方法来实现针对特定元素的扩展。</p>
<p>举个例子，现在我们要给所有指向外链的超链接加上跳转提示，怎么做？</p>
<p>先写出用户调用的代码：</p>
<div class="hlcode"><pre><span class="err">$</span><span class="p">(</span><span class="err">&#39;#</span><span class="n">main</span> <span class="n">a</span><span class="err">&#39;</span><span class="p">).</span><span class="n">external</span><span class="p">();</span>
</pre></div>


<p>然后按照上面的方法编写一个<code>external</code>扩展：</p>
<div class="hlcode"><pre><span class="err">$</span><span class="bp">.</span><span class="nx">fn.external</span> <span class="o">=</span> <span class="nx">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// return返回的each()返回结果，支持链式调用:</span>
    <span class="k">return</span> <span class="nx">this.filter</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="bp">.</span><span class="nb">each</span><span class="p">(</span><span class="nx">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 注意: each()内部的回调函数的this绑定为DOM本身!</span>
        <span class="kd">var</span> <span class="n">a</span> <span class="o">=</span> <span class="err">$</span><span class="p">(</span><span class="nx">this</span><span class="p">);</span>
        <span class="kd">var</span> <span class="n">url</span> <span class="o">=</span> <span class="nx">a.attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">url</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">url.indexOf</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">)</span><span class="o">===</span><span class="mi">0</span> <span class="o">||</span> <span class="nx">url.indexOf</span><span class="p">(</span><span class="s1">&#39;https://&#39;</span><span class="p">)</span><span class="o">===</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">a.attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;#0&#39;</span><span class="p">)</span>
             <span class="bp">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span>
             <span class="bp">.</span><span class="nb">append</span><span class="p">(</span><span class="s1">&#39; &lt;i class=&quot;uk-icon-external-link&quot;&gt;&lt;/i&gt;&#39;</span><span class="p">)</span>
             <span class="bp">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">confirm</span><span class="p">(</span><span class="s1">&#39;你确定要前往&#39;</span> <span class="o">+</span> <span class="nb">url</span> <span class="o">+</span> <span class="s1">&#39;？&#39;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">window.open</span><span class="p">(</span><span class="nb">url</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-05-28 09:23:56</p>
      </span>
    </div>

    
    
  </body>
</html>