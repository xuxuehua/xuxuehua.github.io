<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>argparse - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Python_modules">Python_modules</a>&nbsp;&#187;&nbsp;argparse
    <span class="updated">Page Updated&nbsp;
      2018-09-09 10:41
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">argparse</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#argparse">argparse</a><ul>
<li><a href="#_1"></a></li>
<li><a href="#argumentparser">解析器对象 ArgumentParser</a><ul>
<li><a href="#prog">prog 程序名称</a></li>
<li><a href="#usage">usage</a></li>
<li><a href="#description">description 帮助描述</a></li>
<li><a href="#epilog">epilog</a></li>
<li><a href="#parents">parents</a></li>
<li><a href="#formatter_class">formatter_class</a></li>
<li><a href="#prefix_chars">prefix_chars</a></li>
<li><a href="#fromfile_prefix_chars">fromfile_prefix_chars</a></li>
<li><a href="#argument_default">argument_default</a></li>
<li><a href="#conflict_handler">conflict_handler</a></li>
<li><a href="#add_help-help">add_help 显示help提示</a></li>
</ul>
</li>
<li><a href="#add_argument">命令参数 add_argument()</a><ul>
<li><a href="#name-or-flags">name or flags</a><ul>
<li><a href="#_2">位置参数</a></li>
<li><a href="#_3">可选参数</a></li>
<li><a href="#_4">参数简写</a></li>
</ul>
</li>
<li><a href="#action">action</a></li>
<li><a href="#nargs">nargs 参数数量</a></li>
<li><a href="#const">const</a></li>
<li><a href="#default">default 不提供该参数</a></li>
<li><a href="#type">type</a></li>
<li><a href="#choices">choices</a></li>
<li><a href="#required">required</a></li>
<li><a href="#desk">desk</a></li>
</ul>
</li>
<li><a href="#_5">解析参数</a><ul>
<li><a href="#_6">多参数共存</a></li>
<li><a href="#_7">参数冲突</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="argparse">argparse</h1>
<p>python的命令行解析工具，或者说可以在python代码中调用shell的一些命令，从而简化和系统命令之间的交互。</p>
<h2 id="_1"></h2>
<h2 id="argumentparser">解析器对象 ArgumentParser</h2>
<p>创建解析器对象ArgumentParser，可以添加参数。</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">epilog</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="p">[],</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">HelpFormatter</span><span class="p">,</span> <span class="n">prefix_chars</span><span class="o">=</span><span class="sc">&#39;-&#39;</span><span class="p">,</span> <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">argument_default</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">conflict_handler</span><span class="o">=</span><span class="err">&#39;</span><span class="n">error</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
</pre></div>


<h3 id="prog">prog 程序名称</h3>
<p>程序的名字，默认为sys.argv[0]，用来在help信息中描述程序的名称。</p>
<div class="hlcode"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">myprogram</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">print_help</span><span class="p">()</span>
</pre></div>


<h3 id="usage">usage</h3>
<p>描述程序用途的字符串</p>
<div class="hlcode"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PROG</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="err">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span><span class="n">s</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<h3 id="description">description 帮助描述</h3>
<p>help信息前的文字</p>
<div class="hlcode"><pre><span class="n">parser</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&quot;This is a example program &quot;</span><span class="p">)</span>
</pre></div>


<h3 id="epilog">epilog</h3>
<p>help信息之后的信息</p>
<div class="hlcode"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="err">&#39;</span><span class="n">A</span> <span class="n">foo</span> <span class="n">that</span> <span class="n">bars</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">epilog</span><span class="o">=</span><span class="s">&quot;And that&#39;s how you&#39;d foo a bar&quot;</span><span class="p">)</span>
</pre></div>


<h3 id="parents">parents</h3>
<p>由ArgumentParser对象组成的列表，它们的arguments选项会被包含到新ArgumentParser对象中</p>
<div class="hlcode"><pre> <span class="n">parent_parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
 <span class="n">parent_parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">parent</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">)</span>
 <span class="n">foo_parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">parent_parser</span><span class="p">])</span>
 <span class="n">foo_parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">)</span>
 <span class="n">foo_parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">&#39;</span><span class="o">--</span><span class="n">parent</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;2&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">XXX</span><span class="err">&#39;</span><span class="p">])</span>

 <span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="err">&#39;</span><span class="n">XXX</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<h3 id="formatter_class">formatter_class</h3>
<p>help信息输出的格式</p>
<h3 id="prefix_chars">prefix_chars</h3>
<p>参数前缀，默认为'-'</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PROG</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">prefix_chars</span><span class="o">=</span><span class="err">&#39;</span><span class="o">-+</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">+</span><span class="n">f</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">++</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">+</span><span class="n">f</span> <span class="n">X</span> <span class="o">++</span><span class="n">bar</span> <span class="n">Y</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="sc">&#39;Y&#39;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="sc">&#39;X&#39;</span><span class="p">)</span>
</pre></div>


<h3 id="fromfile_prefix_chars">fromfile_prefix_chars</h3>
<p>前缀字符，放在文件名之前</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">with</span> <span class="n">open</span><span class="p">(</span><span class="err">&#39;</span><span class="n">args</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;w&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="n">fp</span><span class="o">:</span>
<span class="p">...</span>    <span class="n">fp</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">f</span><span class="err">\</span><span class="n">nbar</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="sc">&#39;@&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">f</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">&#39;</span><span class="o">-</span><span class="n">f</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;@</span><span class="n">args</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span><span class="p">])</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<h3 id="argument_default">argument_default</h3>
<p>参数的全局默认值。例如，要禁止parse_args时的参数默认添加</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">argument_default</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">SUPPRESS</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sc">&#39;?&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">BAR</span><span class="err">&#39;</span><span class="p">])</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="err">&#39;</span><span class="n">BAR</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="sc">&#39;1&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">Namespace</span><span class="p">()</span>
</pre></div>


<h3 id="conflict_handler">conflict_handler</h3>
<p>解决冲突的策略，默认情况下冲突会发生错误</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PROG</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">f</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="err">&#39;</span><span class="n">old</span> <span class="n">foo</span> <span class="n">help</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="err">&#39;</span><span class="n">new</span> <span class="n">foo</span> <span class="n">help</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span><span class="o">:</span>
 <span class="p">..</span>
<span class="nl">ArgumentError:</span> <span class="n">argument</span> <span class="o">--</span><span class="n">foo</span><span class="o">:</span> <span class="n">conflicting</span> <span class="n">option</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="o">--</span><span class="n">foo</span>
</pre></div>


<div class="hlcode"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PROG</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">conflict_handler</span><span class="o">=</span><span class="err">&#39;</span><span class="n">resolve</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">f</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="err">&#39;</span><span class="n">old</span> <span class="n">foo</span> <span class="n">help</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="err">&#39;</span><span class="n">new</span> <span class="n">foo</span> <span class="n">help</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">print_help</span><span class="p">()</span>
<span class="nl">usage:</span> <span class="n">PROG</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">FOO</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">foo</span> <span class="n">FOO</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="o">:</span>
 <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="n">and</span> <span class="n">exit</span>
 <span class="o">-</span><span class="n">f</span> <span class="n">FOO</span>      <span class="n">old</span> <span class="n">foo</span> <span class="n">help</span>
 <span class="o">--</span><span class="n">foo</span> <span class="n">FOO</span>   <span class="n">new</span> <span class="n">foo</span> <span class="n">help</span>
</pre></div>


<h3 id="add_help-help">add_help 显示help提示</h3>
<p>设为False时，help信息里面不再显示-h --help信息</p>
<p>默认为True</p>
<h2 id="add_argument">命令参数 add_argument()</h2>
<p>add_argument()方法，用来指定程序需要接受的命令参数</p>
<div class="hlcode"><pre><span class="n">add_argument</span><span class="p">(</span><span class="n">name</span> <span class="n">or</span> <span class="n">flags</span><span class="p">...[,</span> <span class="n">action</span><span class="p">][,</span> <span class="n">nargs</span><span class="p">][,</span> <span class="k">const</span><span class="p">][,</span> <span class="k">default</span><span class="p">][,</span> <span class="n">type</span><span class="p">][,</span> <span class="n">choices</span><span class="p">][,</span> <span class="n">required</span><span class="p">][,</span> <span class="n">help</span><span class="p">][,</span> <span class="n">metavar</span><span class="p">][,</span> <span class="n">dest</span><span class="p">])</span>
</pre></div>


<h3 id="name-or-flags">name or flags</h3>
<h4 id="_2">位置参数</h4>
<p>解析时没有位置参数就会报错</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;echo the string you use here&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">print</span> <span class="n">args</span><span class="p">.</span><span class="n">echo</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
<span class="nl">usage:</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">echo</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="o">:</span>
  <span class="n">echo</span>        <span class="n">echo</span> <span class="n">the</span> <span class="n">string</span> <span class="n">you</span> <span class="n">use</span> <span class="n">here</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="o">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="n">and</span> <span class="n">exit</span>
</pre></div>


<blockquote>
<p>方法parse_args()通过分析指定的参数返回一些数据，如本例中的echo</p>
<p>因为如果不指定参数类型，argparse默认它是字符串</p>
</blockquote>
<h4 id="_3">可选参数</h4>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">verbosity</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;verbosity turned on&quot;</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">verbosity</span> <span class="mi">1</span>
<span class="n">verbosity</span> <span class="n">turned</span> <span class="n">on</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="nl">usage:</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="o">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="n">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span>
                        <span class="n">increase</span> <span class="n">output</span> <span class="n">verbosity</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">verbosity</span>
<span class="nl">usage:</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">verbosity</span> <span class="n">VERBOSITY</span><span class="p">]</span>
<span class="n">prog</span><span class="p">.</span><span class="n">py</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">argument</span> <span class="o">--</span><span class="n">verbosity</span><span class="o">:</span> <span class="n">expected</span> <span class="n">one</span> <span class="n">argument</span>
</pre></div>


<blockquote>
<p>当指定--verbosity时程序就显示一些东西，没指定的时候就不显示。</p>
</blockquote>
<h4 id="_4">参数简写</h4>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">verbose</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;verbosity turned on&quot;</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">v</span>
<span class="n">verbosity</span> <span class="n">turned</span> <span class="n">on</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="nl">usage:</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="o">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>     <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="n">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="o">--</span><span class="n">verbose</span>  <span class="n">increase</span> <span class="n">output</span> <span class="n">verbosity</span>
</pre></div>


<h3 id="action">action</h3>
<p>默认为store</p>
<p>store_const，值存放在const中：</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">store_const</span><span class="err">&#39;</span><span class="p">,</span> <span class="k">const</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>


<p>store_true和store_false，值存为True或False</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">store_true</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">store_false</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">baz</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">store_false</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span> <span class="o">--</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="n">False</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
</pre></div>


<p>append：存为列表</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">append</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span> <span class="mi">1</span> <span class="o">--</span><span class="n">foo</span> <span class="mi">2</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="p">[</span><span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="sc">&#39;2&#39;</span><span class="p">])</span>
</pre></div>


<p>append_const：存为列表，会根据const关键参数进行添加：</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">str</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="err">&#39;</span><span class="n">types</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">append_const</span><span class="err">&#39;</span><span class="p">,</span> <span class="k">const</span><span class="o">=</span><span class="n">str</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="kt">int</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="err">&#39;</span><span class="n">types</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">append_const</span><span class="err">&#39;</span><span class="p">,</span> <span class="k">const</span><span class="o">=</span><span class="kt">int</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">str</span> <span class="o">--</span><span class="kt">int</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">types</span><span class="o">=</span><span class="p">[</span><span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="n">str</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">type</span> <span class="err">&#39;</span><span class="kt">int</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="p">])</span>
</pre></div>


<p>count：统计参数出现的次数</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">verbose</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="o">-</span><span class="n">v</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">count</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">vvv</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>help：help信息</p>
<p>version：版本</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">import</span> <span class="n">argparse</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PROG</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">version</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="err">&#39;</span><span class="n">version</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="err">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span><span class="n">s</span> <span class="mf">2.0</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">&#39;</span><span class="o">--</span><span class="n">version</span><span class="err">&#39;</span><span class="p">])</span>
<span class="n">PROG</span> <span class="mf">2.0</span>
</pre></div>


<h3 id="nargs">nargs 参数数量</h3>
<p>值可以为整数N(N个)，*(任意多个)，+(一个或更多)， ? (可有可无)</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sc">&#39;*&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sc">&#39;*&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="n">baz</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sc">&#39;*&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="n">a</span> <span class="n">b</span> <span class="o">--</span><span class="n">foo</span> <span class="n">x</span> <span class="n">y</span> <span class="o">--</span><span class="n">bar</span> <span class="mi">1</span> <span class="mi">2</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="p">[</span><span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="sc">&#39;2&#39;</span><span class="p">],</span> <span class="n">baz</span><span class="o">=</span><span class="p">[</span><span class="sc">&#39;a&#39;</span><span class="p">,</span> <span class="sc">&#39;b&#39;</span><span class="p">],</span> <span class="n">foo</span><span class="o">=</span><span class="p">[</span><span class="sc">&#39;x&#39;</span><span class="p">,</span> <span class="sc">&#39;y&#39;</span><span class="p">])</span>
</pre></div>


<p>值为？时，首先从命令行获得参数，若没有则从const获得，然后从default获得：</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sc">&#39;?&#39;</span><span class="p">,</span> <span class="k">const</span><span class="o">=</span><span class="sc">&#39;c&#39;</span><span class="p">,</span> <span class="k">default</span><span class="o">=</span><span class="sc">&#39;d&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="sc">&#39;?&#39;</span><span class="p">,</span> <span class="k">default</span><span class="o">=</span><span class="sc">&#39;d&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="n">XX</span> <span class="o">--</span><span class="n">foo</span> <span class="n">YY</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="err">&#39;</span><span class="n">XX</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="err">&#39;</span><span class="n">YY</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="n">XX</span> <span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="err">&#39;</span><span class="n">XX</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="sc">&#39;c&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="sc">&#39;d&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="sc">&#39;d&#39;</span><span class="p">)</span>
</pre></div>


<p>更常用的情况是允许参数为文件</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="nx">argparse.ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nx">parser.add_argument</span><span class="p">(</span><span class="s1">&#39;infile&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="nx">argparse.FileType</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">),</span>
<span class="nx">...</span>                     <span class="n">default</span><span class="o">=</span><span class="nx">sys.stdin</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nx">parser.add_argument</span><span class="p">(</span><span class="s1">&#39;outfile&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="k">type</span><span class="o">=</span><span class="nx">argparse.FileType</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">),</span>
<span class="nx">...</span>                     <span class="n">default</span><span class="o">=</span><span class="nx">sys.stdout</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nx">parser.parse_args</span><span class="p">(</span><span class="err">[</span><span class="s1">&#39;input.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;output.txt&#39;</span><span class="cp">]</span>)
Namespace(infile=<span class="nt">&lt;open</span> <span class="na">file</span> <span class="err">&#39;</span><span class="na">input</span><span class="err">.</span><span class="na">txt</span><span class="err">&#39;,</span> <span class="na">mode</span> <span class="err">&#39;</span><span class="na">r</span><span class="err">&#39;</span> <span class="na">at</span> <span class="na">0x</span><span class="err">...</span><span class="nt">&gt;</span>,
          outfile=<span class="nt">&lt;open</span> <span class="na">file</span> <span class="err">&#39;</span><span class="na">output</span><span class="err">.</span><span class="na">txt</span><span class="err">&#39;,</span> <span class="na">mode</span> <span class="err">&#39;</span><span class="na">w</span><span class="err">&#39;</span> <span class="na">at</span> <span class="na">0x</span><span class="err">...</span><span class="nt">&gt;</span>)
&gt;&gt;&gt; parser.parse_args(<span class="cp">[]</span>)
Namespace(infile=<span class="nt">&lt;open</span> <span class="na">file</span> <span class="err">&#39;&lt;</span><span class="na">stdin</span><span class="nt">&gt;</span>&#39;, mode &#39;r&#39; at 0x...&gt;,
          outfile=<span class="nt">&lt;open</span> <span class="na">file</span> <span class="err">&#39;&lt;</span><span class="na">stdout</span><span class="nt">&gt;</span>&#39;, mode &#39;w&#39; at 0x...&gt;)
</pre></div>


<h3 id="const">const</h3>
<p>保存一个常量</p>
<h3 id="default">default 不提供该参数</h3>
<p>default设置它的默认值为0，这样可以让它兼容其他整型。注意，如果一个可选参数没有指定，它就会被设置成None，None是不能和整型比较的(触发TypeError异常)</p>
<p>一般和？* 配合使用</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="k">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&quot;increase output verbosity&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">square</span><span class="o">**</span><span class="mi">2</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;the square of {} equals {}&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="n">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;{}^2 == {}&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">square</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="nl">else:</span>
    <span class="n">print</span> <span class="n">answer</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span>
<span class="mi">16</span>
</pre></div>


<h3 id="type">type</h3>
<p>参数类型, 指定argparse 类型</p>
<div class="hlcode"><pre><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;square&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;display a square of a given number&quot;</span><span class="p">,</span>
                    <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">)</span>
</pre></div>


<h3 id="choices">choices</h3>
<p>可供选择的值</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">``&#39;</span><span class="n">doors</span><span class="p">.</span><span class="n">py</span><span class="err">&#39;``</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">``&#39;</span><span class="n">door</span><span class="err">&#39;``</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="err">``</span><span class="kt">int</span><span class="err">``</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">print</span><span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">``</span><span class="sc">&#39;3&#39;</span><span class="err">``</span><span class="p">]))</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">door</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">``</span><span class="sc">&#39;4&#39;</span><span class="err">``</span><span class="p">])</span>
<span class="nl">usage:</span> <span class="n">doors</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">}</span>
<span class="n">doors</span><span class="p">.</span><span class="n">py</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">argument</span> <span class="n">door</span><span class="o">:</span> <span class="n">invalid</span> <span class="n">choice</span><span class="o">:</span> <span class="mi">4</span> <span class="p">(</span><span class="n">choose</span> <span class="err">``</span><span class="n">from</span><span class="err">`</span> <span class="err">`</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>


<h3 id="required">required</h3>
<p>是否必选</p>
<h3 id="desk">desk</h3>
<p>可作为参数名</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span> <span class="n">XXX</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="err">&#39;</span><span class="n">XXX</span><span class="err">&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="_5">解析参数</h2>
<p>最常见的空格分开</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PROG</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">x</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">-</span><span class="n">x</span> <span class="n">X</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="sc">&#39;X&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span> <span class="n">FOO</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="err">&#39;</span><span class="n">FOO</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">None</span><span class="p">)</span>
</pre></div>


<p>长选项用=分开</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="o">=</span><span class="n">FOO</span><span class="err">&#39;</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="err">&#39;</span><span class="n">FOO</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">None</span><span class="p">)</span>
</pre></div>


<p>短选项可以写在一起：</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">(</span><span class="err">``&#39;</span><span class="o">-</span><span class="n">xX</span><span class="err">&#39;``</span><span class="p">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="err">``</span><span class="sc">&#39;X&#39;</span><span class="err">``</span><span class="p">)</span>
</pre></div>


<p>parse_args()方法的返回值为namespace，可以用vars()内建函数化为字典</p>
<div class="hlcode"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">([</span><span class="err">&#39;</span><span class="o">--</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">BAR</span><span class="err">&#39;</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">vars</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span><span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">BAR</span><span class="err">&#39;</span><span class="p">}</span>
</pre></div>


<h3 id="_6">多参数共存</h3>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the base&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the exponent&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbosity&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="k">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">x</span><span class="o">**</span><span class="n">args</span><span class="p">.</span><span class="n">y</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;Running &#39;{}&#39;&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">verbosity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;{}^{} ==&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">y</span><span class="p">),</span>
<span class="n">print</span> <span class="n">answer</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span>
<span class="mi">16</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span> <span class="o">-</span><span class="n">v</span>
<span class="mi">4</span><span class="o">^</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">16</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span> <span class="o">-</span><span class="n">vv</span>
<span class="n">Running</span> <span class="err">&#39;</span><span class="n">prog</span><span class="p">.</span><span class="n">py</span><span class="err">&#39;</span>
<span class="mi">4</span><span class="o">^</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">16</span>
</pre></div>


<h3 id="_7">参数冲突</h3>
<p>add_mutually_exclusive_group() 它可以让我们指定某个参数和其他参数冲突。</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
<span class="n">group</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the base&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="kt">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the exponent&quot;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">answer</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">x</span><span class="o">**</span><span class="n">args</span><span class="p">.</span><span class="n">y</span>

<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">quiet</span><span class="o">:</span>
    <span class="n">print</span> <span class="n">answer</span>
<span class="n">elif</span> <span class="n">args</span><span class="p">.</span><span class="n">verbose</span><span class="o">:</span>
    <span class="n">print</span> <span class="s">&quot;{} to the power {} equals {}&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
<span class="nl">else:</span>
    <span class="n">print</span> <span class="s">&quot;{}^{} == {}&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span>
<span class="mi">4</span><span class="o">^</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">16</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span> <span class="o">-</span><span class="n">q</span>
<span class="mi">16</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span> <span class="o">-</span><span class="n">v</span>
<span class="mi">4</span> <span class="n">to</span> <span class="n">the</span> <span class="n">power</span> <span class="mi">2</span> <span class="n">equals</span> <span class="mi">16</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span> <span class="o">-</span><span class="n">vq</span>
<span class="nl">usage:</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span> <span class="o">|</span> <span class="o">-</span><span class="n">q</span><span class="p">]</span> <span class="n">x</span> <span class="n">y</span>
<span class="n">prog</span><span class="p">.</span><span class="n">py</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">argument</span> <span class="o">-</span><span class="n">q</span><span class="o">/--</span><span class="n">quiet</span><span class="o">:</span> <span class="n">not</span> <span class="n">allowed</span> <span class="n">with</span> <span class="n">argument</span> <span class="o">-</span><span class="n">v</span><span class="o">/--</span><span class="n">verbose</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="mi">4</span> <span class="mi">2</span> <span class="o">-</span><span class="n">v</span> <span class="o">--</span><span class="n">quiet</span>
<span class="nl">usage:</span> <span class="n">prog</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">v</span> <span class="o">|</span> <span class="o">-</span><span class="n">q</span><span class="p">]</span> <span class="n">x</span> <span class="n">y</span>
<span class="n">prog</span><span class="p">.</span><span class="n">py</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">argument</span> <span class="o">-</span><span class="n">q</span><span class="o">/--</span><span class="n">quiet</span><span class="o">:</span> <span class="n">not</span> <span class="n">allowed</span> <span class="n">with</span> <span class="n">argument</span> <span class="o">-</span><span class="n">v</span><span class="o">/--</span><span class="n">verbose</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-06-01 01:33:42</p>
      </span>
    </div>

    
    
  </body>
</html>