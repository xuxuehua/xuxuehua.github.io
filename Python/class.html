<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>class 类 - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Python">Python</a>&nbsp;&#187;&nbsp;class 类
    <span class="updated">Page Updated&nbsp;
      2018-09-03 01:33
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">class 类</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">类之间的关系</a></li>
<li><a href="#_2">类的定义</a><ul>
<li><a href="#_3">定义类属性</a></li>
<li><a href="#_4">方法定义 (类中的函数)</a><ul>
<li><a href="#_5">实例方法</a><ul>
<li><a href="#_6">操作类变量</a></li>
</ul>
</li>
<li><a href="#_7">私有方法 (双下划线开头)</a><ul>
<li><a href="#_8">私有方法原理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#self">self</a></li>
</ul>
</li>
<li><a href="#_9">类的属性</a><ul>
<li><a href="#_10">实例变量</a></li>
<li><a href="#_11">保护变量（单下划线开头）</a></li>
<li><a href="#_12">私有变量 (双下划线开头)</a></li>
<li><a href="#_13">类变量</a></li>
<li><a href="#_14">私有类变量 (双下划线开头)</a></li>
</ul>
</li>
<li><a href="#_15">类及变量权限访问</a></li>
<li><a href="#_16">实例化</a></li>
<li><a href="#_17">实例化类原理</a></li>
<li><a href="#_18">封装</a><ul>
<li><a href="#_19">数据及行为封装</a></li>
</ul>
</li>
<li><a href="#type">type 类</a></li>
<li><a href="#metaclass">元类 metaclass</a><ul>
<li><a href="#_20">特性</a></li>
<li><a href="#metaclass_1">metaclass底层实现</a></li>
</ul>
</li>
<li><a href="#instance">instance() 函数判断对象类型</a></li>
<li><a href="#_21">函数重载</a></li>
<li><a href="#_22">类拆分 （优化）</a></li>
</ul>
</div>
<h1 id="_1">类之间的关系</h1>
<p>类和类之间的关系有三种：is-a、has-a和use-a关系</p>
<ul>
<li>is-a关系也叫继承或泛化，比如学生和人的关系、手机和电子产品的关系都属于继承关系。</li>
<li>has-a关系通常称之为关联，比如部门和员工的关系，汽车和引擎的关系都属于关联关系；关联关系如果是整体和部分的关联，那么我们称之为聚合关系；如果整体进一步负责了部分的生命周期（整体和部分是不可分割的，同时同在也同时消亡），那么这种就是最强的关联关系，我们称之为合成关系。</li>
<li>use-a关系通常称之为依赖，比如司机有一个驾驶的行为（方法），其中（的参数）使用到了汽车，那么司机和汽车的关系就是依赖关系。</li>
</ul>
<p>使用一种叫做<a href="https://zh.wikipedia.org/wiki/统一建模语言">UML</a>（统一建模语言）的东西来进行面向对象建模，其中一项重要的工作就是把类和类之间的关系用标准化的图形符号描述出来。</p>
<p>利用类之间的这些关系，我们可以在已有类的基础上来完成某些操作，也可以在已有类的基础上创建新的类，这些都是实现代码复用的重要手段。</p>
<p><img alt="img" src="https://snag.gy/pDjZHr.jpg" /></p>
<h1 id="_2">类的定义</h1>
<p>类是现实世界或者思维世界中的实体在计算机中的反映</p>
<p>它将数据以及这些数据上的操作封装在一起</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">ClassName</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c"># 等价于</span>

<span class="k">class</span> <span class="nc">ClassName</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>


<div class="hlcode"><pre><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>          <span class="c">#定义一个类Person</span>
    <span class="k">def</span> <span class="nf">SayHi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c">#类成员函数必须要有一个参数self,表示类的实例(对象)自身</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Hi&#39;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>           <span class="c">#定义类Person的对象p, 用p来访问类的成员变量和成员函数</span>
<span class="n">p</span><span class="o">.</span><span class="n">SayHi</span><span class="p">()</span>              <span class="c">#调用类Person的成员函数SayHi() </span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">hi</span>
</pre></div>


<h2 id="_3">定义类属性</h2>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">True</span>
</pre></div>


<h2 id="_4">方法定义 (类中的函数)</h2>
<p>写在类中的函数，我们通常称之为（对象的）方法</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">ClassName</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">method_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>


<p>相对于普通函数，需要传入self参数</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">print_file</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">pass</span>
</pre></div>


<h3 id="_5">实例方法</h3>
<p>是和对象实例相关联的，是实例可以调用的</p>
<p>用于描述类的行为</p>
<h4 id="_6">操作类变量</h4>
<p>也可以来操作类变量, 但类变量有专门操作的classmethod</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">Student</span><span class="p">()</span><span class="o">:</span>
    <span class="n">sum1</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">sum1</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Total students is &quot;</span> <span class="o">+</span> <span class="n">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">sum1</span><span class="p">))</span>


<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Rick</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Michelle</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Sam</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">Total</span> <span class="n">students</span> <span class="n">is</span> <span class="mi">1</span>
<span class="n">Total</span> <span class="n">students</span> <span class="n">is</span> <span class="mi">2</span>
<span class="n">Total</span> <span class="n">students</span> <span class="n">is</span> <span class="mi">3</span>
</pre></div>


<h3 id="_7">私有方法 (双下划线开头)</h3>
<p><code>__val</code> 但不以__结尾的</p>
<p><code>__private_method</code>：两个下划线开头，声明该方法为私有方法，不能在类地外部调用。在类的内部调用 <code>self.__private_methods</code></p>
<div class="hlcode"><pre><span class="nb">class</span> <span class="nx">A</span><span class="p">:</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nx">x</span><span class="p">):</span>
        <span class="bp">self.</span><span class="nx">__val</span> <span class="o">=</span> <span class="nx">x</span>

    <span class="nx">def</span> <span class="nx">__add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nx">i</span><span class="p">):</span>
        <span class="bp">self.</span><span class="nx">__val</span> <span class="o">+=</span> <span class="nx">i</span>

    <span class="nx">def</span> <span class="nx">get_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self.</span><span class="nx">__val</span>

    <span class="nx">def</span> <span class="nx">increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self.</span><span class="nx">__add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="nx">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="nx">a.__add</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="nx">Traceback</span> <span class="p">(</span><span class="nx">most</span> <span class="nx">recent</span> <span class="nb">call</span> <span class="nb">last</span><span class="p">):</span>
  <span class="nb">File</span> <span class="s2">&quot;/Users/xhxu/python/python3/test/10.py&quot;</span><span class="p">,</span> <span class="nb">line</span> <span class="mi">15</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span>
    <span class="nx">a.__add</span><span class="p">()</span>
<span class="nx">AttributeError</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span> <span class="nb">object</span> <span class="nx">has</span> <span class="nx">no</span> <span class="nx">attribute</span> <span class="s1">&#39;__add&#39;</span>
</pre></div>


<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__val</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">def</span> <span class="n">__add</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__val</span> <span class="o">+=</span> <span class="n">i</span>

    <span class="n">def</span> <span class="n">get_val</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">__val</span>

    <span class="n">def</span> <span class="n">increase</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">get_val</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">5</span>
</pre></div>


<p>在类内部对行为进行封装, increase 对__add封装</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__val</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">def</span> <span class="n">__add</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__val</span> <span class="o">+=</span> <span class="n">i</span>

    <span class="n">def</span> <span class="n">get_val</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">__val</span>

    <span class="n">def</span> <span class="n">increase</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">get_val</span><span class="p">())</span>

<span class="n">a</span><span class="p">.</span><span class="n">increase</span><span class="p">()</span>
<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">get_val</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">5</span>
<span class="mi">6</span>
</pre></div>


<h4 id="_8">私有方法原理</h4>
<p>python并没有真正的私有，变量改名 _classname__val来绕过</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__val</span> <span class="o">=</span> <span class="n">x</span>

    <span class="n">def</span> <span class="n">__add</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__val</span> <span class="o">+=</span> <span class="n">i</span>

    <span class="n">def</span> <span class="n">get_val</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">__val</span>

    <span class="n">def</span> <span class="n">increase</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">get_val</span><span class="p">())</span>

<span class="n">a</span><span class="p">.</span><span class="n">increase</span><span class="p">()</span>
<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">get_val</span><span class="p">())</span>

<span class="n">print</span><span class="p">(</span><span class="n">dir</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">_A__val</span><span class="p">)</span>

<span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="mi">5</span>
<span class="mi">6</span>
<span class="p">[</span><span class="err">&#39;</span><span class="n">_A__add</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_A__val</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__class__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__delattr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__dict__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__dir__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__doc__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__eq__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__format__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__ge__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__getattribute__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__gt__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__hash__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__init__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__init_subclass__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__le__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__lt__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__module__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__ne__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__new__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__reduce__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__reduce_ex__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__repr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__setattr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__sizeof__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__str__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__subclasshook__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__weakref__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">get_val</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">increase</span><span class="err">&#39;</span><span class="p">]</span>
<span class="mi">6</span>
<span class="p">{</span><span class="err">&#39;</span><span class="n">_A__val</span><span class="err">&#39;</span><span class="o">:</span> <span class="mi">6</span><span class="p">}</span>
</pre></div>


<div class="hlcode"><pre><span class="n">class</span> <span class="n">Student</span><span class="p">()</span><span class="o">:</span>
    <span class="n">sum1</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">sum1</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Total students is &quot;</span> <span class="o">+</span> <span class="n">str</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">sum1</span><span class="p">))</span>

    <span class="n">def</span> <span class="n">marking</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">:</span>
            <span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Invalid</span> <span class="n">num</span><span class="err">&#39;</span><span class="p">)</span>
        <span class="nl">else:</span>
            <span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">score</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">score</span><span class="p">)</span>


    <span class="n">def</span> <span class="n">do_homework</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">pass</span>

    <span class="n">def</span> <span class="n">do_english_homework</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">pass</span>

<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Rick</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Michelle</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">student1</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Sam</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">student</span><span class="p">.</span><span class="n">marking</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">student1</span><span class="p">.</span><span class="n">__score</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">print</span><span class="p">(</span><span class="n">student1</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">student1</span><span class="p">.</span><span class="n">_Student__score</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Total</span> <span class="n">students</span> <span class="n">is</span> <span class="mi">1</span>
<span class="n">Total</span> <span class="n">students</span> <span class="n">is</span> <span class="mi">2</span>
<span class="n">Total</span> <span class="n">students</span> <span class="n">is</span> <span class="mi">3</span>
<span class="n">Invalid</span> <span class="n">num</span>
<span class="p">{</span><span class="err">&#39;</span><span class="n">age</span><span class="err">&#39;</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__score</span><span class="err">&#39;</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">name</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">Sam</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_Student__score</span><span class="err">&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="mi">0</span>
</pre></div>


<blockquote>
<p>这里将<code>__score</code> 的私有变量重新命名成<code>_Student__score</code> 这种类名+score 的形式</p>
<p>但是可以强行读取到数值</p>
</blockquote>
<h2 id="self">self</h2>
<p>self就是当前调用某一个方法的对象， self 代表的是一个实例，而不是一个类</p>
<p>可以在类中定义成为任意的标识，比如this， 但约定统一使用self</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Rick&#39;</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">18</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="n">this</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">this</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</pre></div>


<h1 id="_9">类的属性</h1>
<h2 id="_10">实例变量</h2>
<p>定义在方法中的变量，只作用于当前实例的类。</p>
<p>实例变量的作用域，就是实例本身</p>
<p>类可以访问；类内部可以访问；派生类中可以访问</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">C</span><span class="o">:</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">var</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">public</span> <span class="n">var</span><span class="err">&#39;</span>

    <span class="n">def</span> <span class="n">func</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">var</span><span class="p">)</span>


<span class="n">class</span> <span class="n">D</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">:</span>

    <span class="n">def</span> <span class="n">show</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">var</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="n">obj</span><span class="p">.</span><span class="n">var</span>   <span class="err">#</span> <span class="err">对象的属性引用</span>
<span class="n">obj</span><span class="p">.</span><span class="n">func</span><span class="p">()</span>

<span class="n">obj_son</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="n">obj_son</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">public</span> <span class="n">var</span>
<span class="n">public</span> <span class="n">var</span>
</pre></div>


<h2 id="_11">保护变量（单下划线开头）</h2>
<p>"单下划线" 开始的成员变量叫做保护变量，意思是只有类对象和子类对象自己能访问到这些变量</p>
<p>不过根据python的约定，应该将其视作private，而不要在外部使用它们</p>
<p>​    </p>
<h2 id="_12">私有变量 (双下划线开头)</h2>
<p>"双下划线" 开始的是私有成员，意思是只有类对象自己能访问，连子类对象也不能访问到这个数据</p>
<p>仅类内部可以访问, 无法被外部调用修改</p>
<p>都是在init方法中定义的</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">C</span><span class="o">:</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__var</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">private</span> <span class="n">var</span><span class="err">&#39;</span>

    <span class="n">def</span> <span class="n">func</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__var</span><span class="p">)</span>


<span class="n">class</span> <span class="n">D</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">:</span>

    <span class="n">def</span> <span class="n">show</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__var</span><span class="p">)</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="n">obj</span><span class="p">.</span><span class="n">__var</span> <span class="err">#</span> <span class="err">通过对象访问</span>    <span class="o">==&gt;</span> <span class="err">错误</span>
<span class="n">obj</span><span class="p">.</span><span class="n">func</span><span class="p">()</span> <span class="err">#</span> <span class="err">类内部访问</span>        <span class="o">==&gt;</span> <span class="err">正确</span>

<span class="n">obj_son</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="n">obj_son</span><span class="p">.</span><span class="n">show</span><span class="p">()</span> <span class="err">#</span> <span class="err">派生类中访问</span>  <span class="o">==&gt;</span> <span class="err">错误</span>
</pre></div>


<h2 id="_13">类变量</h2>
<p>类变量对所有的实例都是可见的，可以共享，且初值都是一样的</p>
<p>定义在方法体之外，可以通过类名访问，对所有方法共享</p>
<p>实例变量没有，会找类变量调用</p>
<p>类变量通常不作为实例变量使用, 即类变量不用做定义实例变量</p>
<p>也称为数据成员，用于描述刻画类的特征</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">val</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>

<span class="n">a2</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>

<span class="n">a1</span><span class="o">.</span><span class="n">val</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">3</span>
<span class="mi">3</span>
<span class="mi">4</span>
</pre></div>


<p>对不可变对象赋值，就会变成新的变量</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">val_s</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="n">pass</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a1</span><span class="p">.</span><span class="n">val</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="n">a1</span><span class="p">.</span><span class="n">val</span><span class="p">,</span> <span class="n">id</span><span class="p">(</span><span class="n">a1</span><span class="p">.</span><span class="n">val</span><span class="p">))</span>
<span class="n">print</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">val</span><span class="p">,</span> <span class="n">id</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">val</span><span class="p">))</span>

<span class="n">a3</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a4</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a3</span><span class="p">.</span><span class="n">val_s</span> <span class="o">=</span> <span class="sc">&#39;s&#39;</span>
<span class="n">print</span><span class="p">(</span><span class="n">a3</span><span class="p">.</span><span class="n">val_s</span><span class="p">,</span> <span class="n">id</span><span class="p">(</span><span class="n">a3</span><span class="p">.</span><span class="n">val_s</span><span class="p">))</span>
<span class="n">print</span><span class="p">(</span><span class="n">a4</span><span class="p">.</span><span class="n">val_s</span><span class="p">,</span> <span class="n">id</span><span class="p">(</span><span class="n">a4</span><span class="p">.</span><span class="n">val_s</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="mi">4442997640</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="mi">4442997640</span>
<span class="n">s</span> <span class="mi">4437293632</span>
<span class="n">a</span> <span class="mi">4437455120</span>
</pre></div>


<p>在类内部中的实例方法内，访问类变量的方式</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">Student</span><span class="p">()</span><span class="o">:</span>
    <span class="n">sum1</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">print</span><span class="p">(</span><span class="n">Student</span><span class="p">.</span><span class="n">sum1</span><span class="p">)</span>


<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Rick</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">0</span>
</pre></div>


<p>或者通过内置变量<code>__class__</code>访问类变量的值</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">Student</span><span class="p">()</span><span class="o">:</span>
    <span class="n">sum1</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">sum1</span><span class="p">)</span>


<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Rick</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">0</span>
</pre></div>


<h2 id="_14">私有类变量 (双下划线开头)</h2>
<p>私有类变量不能被实例访问</p>
<p>类内部可以通过方法访问</p>
<p><code>__private_attrs</code>：两个下划线开头，声明该属性为私有，不能在类的外部被使用或直接访问。在类内部的方法中使用时 <code>self.__private_attrs</code>。</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">__name</span> <span class="o">=</span> <span class="s">&#39;private var&#39;</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;func in C&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">__name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">D</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;show in D&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">__name</span><span class="p">)</span>

<span class="n">C</span><span class="o">.</span><span class="n">__name</span> <span class="c"># 类访问 错误</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="n">obj</span><span class="o">.</span><span class="n">func</span><span class="p">()</span> <span class="c"># 类内部可以访问</span>

<span class="n">obj_son</span> <span class="o">=</span> <span class="n">D</span><span class="p">()</span>
<span class="n">obj_son</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c"># 派生类中访问错误</span>
</pre></div>


<h1 id="_15">类及变量权限访问</h1>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">类能否访问</th>
<th align="left">实例能否访问</th>
<th align="left">类是否能够通过公有类方法调用私有变量</th>
<th align="left">实例是否能够通过公有实例方法调用私有变量</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">私有类变量</td>
<td align="left">×</td>
<td align="left">×</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">私有类方法</td>
<td align="left">×</td>
<td align="left">×</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">私有实例变量</td>
<td align="left">×</td>
<td align="left">×</td>
<td align="left">×</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">私有实例方法</td>
<td align="left">×</td>
<td align="left">×</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">公有类变量</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">公有类方法</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">公有实例变量</td>
<td align="left">×</td>
<td align="left">√</td>
<td align="left">×</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">公有实例方法</td>
<td align="left">×</td>
<td align="left">√</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody>
</table>
<h1 id="_16">实例化</h1>
<p><code>__init__</code> 只是初始化类变量的作用</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="c"># 实例化</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># 绑定实力变量</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">5</span>
</pre></div>


<h1 id="_17">实例化类原理</h1>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;call __new__&quot;</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;type cls&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">(</span><span class="n">cls</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">object</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;call __init__&quot;</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;type self&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">(</span><span class="n">self</span><span class="p">))</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">set</span> <span class="p">(</span><span class="n">dir</span><span class="p">(</span><span class="n">self</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="n">dir</span><span class="p">(</span><span class="n">self</span><span class="p">))</span>
        <span class="n">print</span><span class="p">(</span><span class="n">s2</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">call</span> <span class="n">__new__</span>
<span class="n">type</span> <span class="n">cls</span> <span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">type</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="n">call</span> <span class="n">__init__</span>
<span class="n">type</span> <span class="n">self</span> <span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="p">.</span><span class="n">A</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="p">{</span><span class="sc">&#39;x&#39;</span><span class="p">}</span>
</pre></div>


<blockquote>
<p>cls 代表class A这个对象</p>
<p>dir 会返回所有属性</p>
</blockquote>
<p>若new方法不返回，init方法不执行</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">A</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;call __new__&quot;</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;type cls&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">(</span><span class="n">cls</span><span class="p">))</span>
        <span class="err">#</span> <span class="k">return</span> <span class="n">object</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;call __init__&quot;</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;type self&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">(</span><span class="n">self</span><span class="p">))</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">set</span> <span class="p">(</span><span class="n">dir</span><span class="p">(</span><span class="n">self</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="n">dir</span><span class="p">(</span><span class="n">self</span><span class="p">))</span>
        <span class="n">print</span><span class="p">(</span><span class="n">s2</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="n">call</span> <span class="n">__new__</span>
<span class="n">type</span> <span class="n">cls</span> <span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">type</span><span class="err">&#39;</span><span class="o">&gt;</span>
</pre></div>


<h1 id="_18">封装</h1>
<p>封装只能在类的内部访问</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">__add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__value</span> <span class="o">+=</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__value</span>

    <span class="k">def</span> <span class="nf">__increase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_value</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">__value</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="mi">5</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;/Users/xhxu/python/python3/test/3.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">17</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">__value</span><span class="p">)</span>
<span class="ne">AttributeError</span><span class="p">:</span> <span class="s">&#39;A&#39;</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s">&#39;__value&#39;</span>
</pre></div>


<h2 id="_19">数据及行为封装</h2>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">Door</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&#39;opening&#39;</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&#39;closed&#39;</span>

<span class="n">door1</span> <span class="o">=</span> <span class="n">Door</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;closed&#39;</span><span class="p">)</span>
</pre></div>


<div class="hlcode"><pre><span class="n">from</span> <span class="n">time</span> <span class="n">import</span> <span class="n">sleep</span>

<span class="n">class</span> <span class="n">Clock</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="o">:</span>
    <span class="s">&quot;&quot;&quot;My Clock&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>
        <span class="s">&quot;&quot;&quot;Initial method</span>
        <span class="o">:</span><span class="n">param</span> <span class="n">hour</span><span class="o">:</span> <span class="n">hour</span><span class="o">:</span>
        <span class="o">:</span><span class="n">param</span> <span class="n">minute</span><span class="o">:</span> <span class="n">minute</span>
        <span class="o">:</span><span class="n">param</span> <span class="n">second</span><span class="o">:</span> <span class="n">second</span>
        <span class="s">&quot;&quot;&quot;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_hour</span> <span class="o">=</span> <span class="n">hour</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_minute</span> <span class="o">=</span> <span class="n">minute</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_second</span> <span class="o">=</span> <span class="n">second</span>

    <span class="n">def</span> <span class="n">run</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="s">&quot;&quot;&quot;Working on Clock</span>
        <span class="s">&quot;&quot;&quot;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_second</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_second</span> <span class="o">==</span> <span class="mi">60</span><span class="o">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_second</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">self</span><span class="p">.</span><span class="n">minute</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_minute</span> <span class="o">==</span> <span class="mi">60</span><span class="o">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_minute</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">self</span><span class="p">.</span><span class="n">_hour</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">_hour</span> <span class="o">==</span> <span class="mi">24</span><span class="o">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_hour</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">def</span> <span class="n">show</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="s">&quot;&quot;&quot;Display time</span>
        <span class="s">&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="err">&#39;</span><span class="o">%</span><span class="mo">02</span><span class="n">d</span><span class="o">:%</span><span class="mo">02</span><span class="n">d</span><span class="o">:%</span><span class="mo">02</span><span class="n">d</span><span class="err">&#39;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_hour</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_minute</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_second</span><span class="p">)</span>

<span class="n">def</span> <span class="n">main</span><span class="p">()</span><span class="o">:</span>
    <span class="n">clock</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">True</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="n">clock</span><span class="p">.</span><span class="n">show</span><span class="p">())</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">clock</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="o">:</span>
    <span class="n">main</span><span class="p">()</span>    
</pre></div>


<h1 id="type">type 类</h1>
<p>类 是由 type 类实例化产生</p>
<p>type 有解释器封装生成</p>
<div class="hlcode"><pre><span class="n">def</span> <span class="n">func</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
    <span class="n">print</span> <span class="err">&#39;</span><span class="n">hello</span> <span class="n">wupeiqi</span><span class="err">&#39;</span>

<span class="n">Foo</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Foo</span><span class="err">&#39;</span><span class="p">,(</span><span class="n">object</span><span class="p">,),</span> <span class="p">{</span><span class="err">&#39;</span><span class="n">func</span><span class="err">&#39;</span><span class="o">:</span> <span class="n">func</span><span class="p">})</span>
<span class="cp">#type第一个参数：类名</span>
<span class="cp">#type第二个参数：当前类的基类</span>
<span class="cp">#type第三个参数：类的成员</span>
</pre></div>


<div class="hlcode"><pre><span class="n">def</span> <span class="n">func</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="s">&quot;hello %s&quot;</span><span class="o">%</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">)</span><span class="o">:</span>
    <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<span class="n">Foo</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Foo</span><span class="err">&#39;</span><span class="p">,(</span><span class="n">object</span><span class="p">,),{</span><span class="err">&#39;</span><span class="n">func</span><span class="err">&#39;</span><span class="o">:</span><span class="n">func</span><span class="p">,</span><span class="err">&#39;</span><span class="n">__init__</span><span class="err">&#39;</span><span class="o">:</span><span class="n">__init__</span><span class="p">})</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s">&quot;jack&quot;</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span>
<span class="n">f</span><span class="p">.</span><span class="n">func</span><span class="p">()</span>
</pre></div>


<p>type类中实现的创建类</p>
<p>类中有一个属性 <strong>metaclass</strong>，其用来表示该类由 谁 来实例化创建，所以，我们可以为 <strong>metaclass</strong> 设置一个type类的派生类，从而查看 类 创建的过程。</p>
<p><img alt="img" src="https://cdn.pbrd.co/images/HCW5oNi.png" /></p>
<h1 id="metaclass">元类 metaclass</h1>
<p>类的生成 调用 顺序依次是 <code>__new__</code> --&gt; <code>__init__</code> --&gt; <code>__call__</code></p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">MyType</span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>

        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Mytype __init__&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__call__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Mytype __call__&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;obj &quot;</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="n">def</span> <span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Mytype __new__&quot;</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">here</span><span class="p">...</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">class</span> <span class="n">Foo</span><span class="p">(</span><span class="n">object</span><span class="p">,</span><span class="n">metaclass</span><span class="o">=</span><span class="n">MyType</span><span class="p">)</span><span class="o">:</span>


    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">name</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Foo __init__&quot;</span><span class="p">)</span>

    <span class="n">def</span> <span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="s">&quot;Foo __new__&quot;</span><span class="p">,</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">object</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s">&quot;Alex&quot;</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
<span class="n">print</span><span class="p">(</span><span class="s">&quot;fname&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>

<span class="err">自定义元类</span>
</pre></div>


<h2 id="_20">特性</h2>
<p>yaml是一个家喻户晓的 Python 工具，可以方便地序列化 / 逆序列化结构数据。YAMLObject 的任意子类支持序列化和反序列化（serialization &amp; deserialization）。比如说下面这段代码：</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">Monster</span><span class="p">(</span><span class="n">yaml</span><span class="p">.</span><span class="n">YAMLObject</span><span class="p">)</span><span class="o">:</span>
  <span class="n">yaml_tag</span> <span class="o">=</span> <span class="n">u</span><span class="err">&#39;</span><span class="o">!</span><span class="n">Monster</span><span class="err">&#39;</span>
  <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">attacks</span><span class="p">)</span><span class="o">:</span>
    <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">self</span><span class="p">.</span><span class="n">hp</span> <span class="o">=</span> <span class="n">hp</span>
    <span class="n">self</span><span class="p">.</span><span class="n">ac</span> <span class="o">=</span> <span class="n">ac</span>
    <span class="n">self</span><span class="p">.</span><span class="n">attacks</span> <span class="o">=</span> <span class="n">attacks</span>
  <span class="n">def</span> <span class="n">__repr__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
    <span class="k">return</span> <span class="s">&quot;%s(name=%r, hp=%r, ac=%r, attacks=%r)&quot;</span> <span class="o">%</span> <span class="p">(</span>
       <span class="n">self</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">hp</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">ac</span><span class="p">,</span>      
       <span class="n">self</span><span class="p">.</span><span class="n">attacks</span><span class="p">)</span>

<span class="n">yaml</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="o">---</span> <span class="o">!</span><span class="n">Monster</span>
<span class="nl">name:</span> <span class="n">Cave</span> <span class="n">spider</span>
<span class="nl">hp:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>    <span class="err">#</span> <span class="mi">2</span><span class="n">d6</span>
<span class="nl">ac:</span> <span class="mi">16</span>
<span class="nl">attacks:</span> <span class="p">[</span><span class="n">BITE</span><span class="p">,</span> <span class="n">HURT</span><span class="p">]</span>
<span class="s">&quot;&quot;&quot;)</span>

<span class="n">Monster</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Cave</span> <span class="n">spider</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">hp</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">ac</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">attacks</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="n">BITE</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">HURT</span><span class="err">&#39;</span><span class="p">])</span>

<span class="n">print</span> <span class="n">yaml</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">Monster</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Cave</span> <span class="n">lizard</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">hp</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="n">ac</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">attacks</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="n">BITE</span><span class="sc">&#39;,&#39;</span><span class="n">HURT</span><span class="err">&#39;</span><span class="p">]))</span>

<span class="cp"># 输出</span>
<span class="o">!</span><span class="n">Monster</span>
<span class="nl">ac:</span> <span class="mi">16</span>
<span class="nl">attacks:</span> <span class="p">[</span><span class="n">BITE</span><span class="p">,</span> <span class="n">HURT</span><span class="p">]</span>
<span class="nl">hp:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="nl">name:</span> <span class="n">Cave</span> <span class="n">lizard</span>
</pre></div>


<p>调用统一的 yaml.load()，就能把任意一个 yaml 序列载入成一个 Python Object；而调用统一的 yaml.dump()，就能把一个 YAMLObject 子类序列化。对于 load() 和 dump() 的使用者来说，他们完全不需要提前知道任何类型信息，这让超动态配置编程成了可能。在我的实战经验中，许多大型项目都需要应用这种超动态配置的理念。</p>
<p>比方说，在一个智能语音助手的大型项目中，我们有 1 万个语音对话场景，每一个场景都是不同团队开发的。作为智能语音助手的核心团队成员，我不可能去了解每个子场景的实现细节。</p>
<p>在动态配置实验不同场景时，经常是今天我要实验场景 A 和 B 的配置，明天实验 B 和 C 的配置，光配置文件就有几万行量级，工作量不可谓不小。而应用这样的动态配置理念，我就可以让引擎根据我的文本配置文件，动态加载所需要的 Python 类。</p>
<p>对于 YAML 的使用者，这一点也很方便，你只要简单地继承 yaml.YAMLObject，就能让你的 Python Object 具有序列化和逆序列化能力。是不是相比普通 Python 类，有一点“变态”，有一点“超越”？</p>
<h2 id="metaclass_1">metaclass底层实现</h2>
<p>在 Python 的类型世界里，type 这个类就是造物的上帝</p>
<div class="hlcode"><pre><span class="cp"># Python 3 和 Python 2 类似</span>
<span class="n">class</span> <span class="n">MyClass</span><span class="o">:</span>
  <span class="n">pass</span>

<span class="n">instance</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>

<span class="n">type</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
<span class="cp"># 输出</span>
<span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="p">.</span><span class="n">C</span><span class="err">&#39;</span><span class="o">&gt;</span>

<span class="n">type</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span>
<span class="cp"># 输出</span>
<span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">type</span><span class="err">&#39;</span><span class="o">&gt;</span>
</pre></div>


<blockquote>
<p>instance 是 MyClass 的实例，而 MyClass 不过是“上帝”type 的实例</p>
</blockquote>
<p>当我们定义一个类的语句结束时，真正发生的情况，是 Python 调用 type 的<code>__call__</code>, 运算符。简单来说，当你定义一个类时，写成下面这样时：</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">MyClass</span><span class="o">:</span>
  <span class="n">data</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>


<p>Python 真正执行的是下面这段代码：</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">attributedict</span><span class="p">)</span>
</pre></div>


<p>这里等号右边的<code>type(classname, superclasses, attributedict)</code>  ，就是 type 的 <code>__call__</code> 运算符重载，它会进一步调用：</p>
<div class="hlcode"><pre><span class="n">type</span><span class="p">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">typeclass</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">attributedict</span><span class="p">)</span>
<span class="n">type</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">class</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">superclasses</span><span class="p">,</span> <span class="n">attributedict</span><span class="p">)</span>
</pre></div>


<p>代码验证 </p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">MyClass</span><span class="o">:</span>
  <span class="n">data</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">instance</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">MyClass</span><span class="p">,</span> <span class="n">instance</span>
<span class="cp"># 输出</span>
<span class="p">(</span><span class="n">__main__</span><span class="p">.</span><span class="n">MyClass</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="p">.</span><span class="n">MyClass</span> <span class="n">instance</span> <span class="n">at</span> <span class="mh">0x7fe4f0b00ab8</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">instance</span><span class="p">.</span><span class="n">data</span>
<span class="cp"># 输出</span>
<span class="mi">1</span>

<span class="n">MyClass</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="err">&#39;</span><span class="n">MyClass</span><span class="err">&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="err">&#39;</span><span class="n">data</span><span class="err">&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">MyClass</span><span class="p">,</span> <span class="n">instance</span>
<span class="cp"># 输出</span>
<span class="p">(</span><span class="n">__main__</span><span class="p">.</span><span class="n">MyClass</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="p">.</span><span class="n">MyClass</span> <span class="n">at</span> <span class="mh">0x7fe4f0aea5d0</span><span class="o">&gt;</span><span class="p">)</span>

<span class="n">instance</span><span class="p">.</span><span class="n">data</span>
<span class="cp"># 输出</span>
<span class="mi">1</span>
</pre></div>


<h1 id="instance">instance() 函数判断对象类型</h1>
<p>使用instance()函数检测一个给定的对象是否属于（继承）某个类或类型，是为True，否为False</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">val1</span> <span class="o">=</span> <span class="s">&quot;String1&quot;</span>   <span class="c">#静态变量</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val2</span> <span class="o">=</span> <span class="s">&quot;Value 2&quot;</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">MyClass</span><span class="p">))</span>
<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> 
<span class="bp">True</span>
<span class="bp">True</span>
</pre></div>


<h1 id="_21">函数重载</h1>
<p>使子类必须重新写一遍 方法，来覆盖掉原有函数， 这里通过raise 一个exception来提示</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">Entity</span><span class="p">()</span><span class="o">:</span>
      <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">)</span><span class="o">:</span>
          <span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">parent</span> <span class="n">class</span> <span class="n">init</span> <span class="n">called</span><span class="err">&#39;</span><span class="p">)</span>
          <span class="n">self</span><span class="p">.</span><span class="n">object_type</span> <span class="o">=</span> <span class="n">object_type</span>
      <span class="n">def</span> <span class="n">get_context_length</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
          <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="err">&#39;</span><span class="n">get_context_length</span> <span class="n">not</span> <span class="n">implemented</span><span class="err">&#39;</span><span class="p">)</span>
      <span class="n">def</span> <span class="n">print_title</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
          <span class="n">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">title</span><span class="p">)</span>


<span class="n">class</span> <span class="n">Document</span><span class="p">(</span><span class="n">Entity</span><span class="p">)</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span><span class="o">:</span>
        <span class="n">print</span><span class="p">(</span><span class="err">&#39;</span><span class="n">Document</span> <span class="n">class</span> <span class="n">init</span> <span class="n">called</span><span class="err">&#39;</span><span class="p">)</span>
        <span class="n">Entity</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">document</span><span class="err">&#39;</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">self</span><span class="p">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span>
        <span class="n">self</span><span class="p">.</span><span class="n">__context</span> <span class="o">=</span> <span class="n">context</span>
    <span class="n">def</span> <span class="n">get_context_length</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__context</span><span class="p">)</span>
</pre></div>


<h1 id="_22">类拆分 （优化）</h1>
<p>job 在其中出现了很多次，而且它们表达的是一个意义实体，这种情况下，我们可以考虑将这部分分解出来，作为单独的类。</p>
<div class="hlcode"><pre><span class="n">class</span> <span class="n">Person</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">job_title</span><span class="p">,</span> <span class="n">job_description</span><span class="p">,</span> <span class="n">company_name</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sex</span> <span class="o">=</span> <span class="n">sex</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">self</span><span class="p">.</span><span class="n">job_title</span> <span class="o">=</span> <span class="n">job_title</span>
        <span class="n">self</span><span class="p">.</span><span class="n">job_description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">self</span><span class="p">.</span><span class="n">company_name</span> <span class="o">=</span> <span class="n">company_name</span>
</pre></div>


<div class="hlcode"><pre><span class="n">class</span> <span class="n">Person</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">job_title</span><span class="p">,</span> <span class="n">job_description</span><span class="p">,</span> <span class="n">company_name</span><span class="p">)</span><span class="o">:</span>
        <span class="n">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sex</span> <span class="o">=</span> <span class="n">sex</span>
        <span class="n">self</span><span class="p">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="n">self</span><span class="p">.</span><span class="n">job</span> <span class="o">=</span> <span class="n">Job</span><span class="p">(</span><span class="n">job_title</span><span class="p">,</span> <span class="n">job_description</span><span class="p">,</span> <span class="n">company_name</span><span class="p">)</span>

<span class="n">class</span> <span class="n">Job</span><span class="o">:</span>
    <span class="n">def</span> <span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_title</span><span class="p">,</span> <span class="n">job_description</span><span class="p">,</span> <span class="n">company_name</span><span class="p">)</span><span class="o">:</span>

        <span class="n">self</span><span class="p">.</span><span class="n">job_title</span> <span class="o">=</span> <span class="n">job_title</span>
        <span class="n">self</span><span class="p">.</span><span class="n">job_description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="n">self</span><span class="p">.</span><span class="n">company_name</span> <span class="o">=</span> <span class="n">company_name</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-01-24 16:55:26</p>
      </span>
    </div>

    
    
  </body>
</html>