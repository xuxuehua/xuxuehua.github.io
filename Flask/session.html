<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>session - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Flask">Flask</a>&nbsp;&#187;&nbsp;session
    <span class="updated">Page Updated&nbsp;
      2020-01-20 16:45
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">session</div>

  <p>[toc]</p>
<h1 id="session">Session</h1>
<p>Flask 的 session 默认是client side 的，session是写入到浏览器的cookie中，当浏览器关闭，cookie会自动消失</p>
<p>将session数据加密，然后存储在cookie中，这种专业术语叫做client side session， flask采用这种方式</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">url_for</span>

<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">login</span><span class="p">()</span><span class="o">:</span>
    <span class="n">session</span><span class="p">[</span><span class="err">&#39;</span><span class="n">logged_in</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="err">&#39;</span><span class="n">hello</span><span class="err">&#39;</span><span class="p">))</span>
</pre></div>


<blockquote>
<p>session 中的数据可以像字典一样通过键读取，或时使用get方法</p>
</blockquote>
<p>sqlalchemy</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">redis</span>
<span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
<span class="n">from</span> <span class="n">flask_session</span> <span class="n">import</span> <span class="n">Session</span> 
<span class="n">from</span> <span class="n">flask_sqlalchemy</span> <span class="n">import</span> <span class="n">SQLAlchemy</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">adavafa</span><span class="err">&#39;</span>

<span class="cp"># 设置数据库链接</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">mysql</span><span class="o">+</span><span class="n">pymysql</span><span class="o">:</span><span class="c1">//root:dev@127.0.0.1:3306/devops?charset=utf8&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SQLALCHEMY_TRACK_MODIFICATIONS</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span>
<span class="cp"># 实例化SQLAlchemy</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_TYPE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">sqlalchemy</span><span class="err">&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">类型为</span><span class="n">sqlalchemy</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_SQLALCHEMY</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span> <span class="err">#</span> <span class="n">SQLAlchemy</span><span class="err">对象</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_SQLALCHEMY_TABLE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;表名&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">要保存的表名称</span>

<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_PERMANENT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span> <span class="err">#</span> <span class="err">如果设置为</span><span class="n">True</span><span class="err">，则关闭浏览器</span><span class="n">session</span><span class="err">就失效。</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PERMANENT_SESSION_LIFETIME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="cp">#一个持久化的会话的生存时间，是一个datetime.timedelta对象，也可以用一个整数来表示秒,前提设置了PERMANENT_SESSION_LIFETIME为True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_USE_SIGNER</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">False</span> <span class="err">#</span> <span class="err">是否对发送到浏览器上</span><span class="n">session</span><span class="err">的</span><span class="n">cookie</span><span class="err">值进行加密</span><span class="p">,</span><span class="err">默认</span><span class="n">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_KEY_PREFIX</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">flask</span><span class="o">-</span><span class="n">session</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">保存的</span><span class="n">session</span><span class="err">的</span><span class="n">key</span><span class="err">的前缀</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_NAME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span> <span class="err">&#39;</span><span class="n">session_id</span><span class="err">&#39;</span>  <span class="err">#</span> <span class="err">保存在浏览器的</span><span class="n">cookie</span><span class="err">名称</span>


<span class="cp">#其他配置，不经常使用</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_DOMAIN</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">设置</span><span class="n">cookie</span><span class="err">的域名，不建议设置默认为</span><span class="n">server_name</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_PATH</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;/&#39;</span> <span class="err">#</span> <span class="err">会话</span><span class="n">cookie</span><span class="err">的路径。</span> <span class="err">如果未设置，则</span><span class="n">cookie</span><span class="err">将对所有</span><span class="n">url</span><span class="err">有效，默认为</span><span class="sc">&#39;/&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_HTTPONLY</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">True</span> <span class="err">#</span> <span class="err">是否启动</span><span class="n">httponly</span><span class="p">,</span><span class="err">默认为</span><span class="nb">true</span><span class="err">，为了防止</span><span class="n">xss</span><span class="err">脚本访问</span><span class="n">cookie</span>




<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">()</span><span class="o">:</span>
 <span class="n">session</span><span class="p">[</span><span class="s">&quot;username&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;jack&quot;</span>
 <span class="k">return</span> <span class="err">&#39;</span><span class="n">login</span><span class="err">&#39;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
 <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>


<span class="cp">###使用SQLAlchemy时候先确保数据库和表都存在</span>
<span class="err">在命令行中创建表</span>
<span class="cp">#&gt;&gt;&gt; from app import db</span>
<span class="cp">#&gt;&gt;&gt; db.create_all()</span>
</pre></div>


<p>设置数据库</p>
<div class="hlcode"><pre><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">public</span><span class="p">.</span><span class="n">flask_session_table</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">integer</span> <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="n">NOT</span> <span class="nb">NULL</span><span class="p">,</span>
    <span class="n">session_id</span> <span class="n">character</span> <span class="n">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">data</span> <span class="n">bytea</span><span class="p">,</span>
    <span class="n">expiry</span> <span class="n">timestamp</span> <span class="n">without</span> <span class="n">time</span> <span class="n">zone</span>
<span class="p">);</span>
</pre></div>


<h2 id="_1">注意点</h2>
<p>尽管session对象对Cookie进行签名并加密，这种方式仅能够保证session的内容不会被篡改，加密后的数据借助工具仍然可以被轻易读取，所以不能在session中存储敏感信息</p>
<h2 id="_2">原理</h2>
<p>flask内置session本质上依靠上下文，当请求到来时，调用session_interface中的open_session方法解密获取session的字典，并保存在RequestContext.session中，也就是上下文中，然后在视图函数执行完毕后调用session_interface的save_session方法，将session以加密的方式写入response的cookie中，浏览器再保存数据。而第三方的session组件原理就是基于是open_session方法和save方法，从而实现session更多的session保存方案。</p>
<h1 id="flask-session">flask-session</h1>
<p>flask-session支持多种数据库session保存方案如：redis、memchached、mongodb甚至文件系统等。</p>
<div class="hlcode"><pre><span class="n">pip3</span> <span class="n">install</span> <span class="n">flask</span><span class="o">-</span><span class="n">session</span>
</pre></div>


<h2 id="redis">redis</h2>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">redis</span>
<span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
<span class="n">from</span> <span class="n">flask_session</span> <span class="n">import</span> <span class="n">Session</span>
<span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">timedelta</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">adavafa</span><span class="err">&#39;</span>



<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_TYPE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">redis</span><span class="err">&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">类型为</span><span class="n">redis</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_PERMANENT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span> <span class="err">#</span> <span class="err">如果设置为</span><span class="n">True</span><span class="err">，则关闭浏览器</span><span class="n">session</span><span class="err">就失效。</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PERMANENT_SESSION_LIFETIME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="cp">#一个持久化的会话的生存时间，是一个datetime.timedelta对象，也可以用一个整数来表示秒,前提设置了PERMANENT_SESSION_LIFETIME为True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_USE_SIGNER</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">False</span> <span class="err">#</span> <span class="err">是否对发送到浏览器上</span><span class="n">session</span><span class="err">的</span><span class="n">cookie</span><span class="err">值进行加密</span><span class="p">,</span><span class="err">默认</span><span class="n">False</span> 
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_KEY_PREFIX</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">flask</span><span class="o">-</span><span class="n">session</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">保存到</span><span class="n">redis</span><span class="err">中的</span><span class="n">key</span><span class="err">的前缀</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_NAME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span> <span class="err">&#39;</span><span class="n">session_id</span><span class="err">&#39;</span>  <span class="err">#</span> <span class="err">保存在浏览器的</span><span class="n">cookie</span><span class="err">名称</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_REDIS</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">10.1.210.33</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="err">‘</span><span class="mi">6379</span><span class="err">&#39;</span><span class="p">,</span><span class="n">password</span><span class="o">=</span><span class="err">‘</span><span class="mi">123123</span><span class="err">&#39;</span><span class="p">)</span> <span class="err">#</span> <span class="err">用于连接</span><span class="n">redis</span><span class="err">的配置</span>


<span class="cp">#其他配置，不经常使用</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_DOMAIN</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">设置</span><span class="n">cookie</span><span class="err">的域名，不建议设置默认为</span><span class="n">server_name</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_PATH</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;/&#39;</span> <span class="err">#</span> <span class="err">会话</span><span class="n">cookie</span><span class="err">的路径。</span> <span class="err">如果未设置，则</span><span class="n">cookie</span><span class="err">将对所有</span><span class="n">url</span><span class="err">有效，默认为</span><span class="sc">&#39;/&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_HTTPONLY</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">True</span> <span class="err">#</span> <span class="err">是否启动</span><span class="n">httponly</span><span class="p">,</span><span class="err">默认为</span><span class="nb">true</span><span class="err">，为了防止</span><span class="n">xss</span><span class="err">脚本访问</span><span class="n">cookie</span>

<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">()</span><span class="o">:</span>
 <span class="n">session</span><span class="p">[</span><span class="s">&quot;username&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;jack&quot;</span>
 <span class="k">return</span> <span class="err">&#39;</span><span class="n">login</span><span class="err">&#39;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
 <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h2 id="memchached">Memchached</h2>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">memcache</span>
<span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
<span class="n">from</span> <span class="n">flask_session</span> <span class="n">import</span> <span class="n">Session</span>
<span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">timedelta</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">adavafa</span><span class="err">&#39;</span>



<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_TYPE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">‘</span><span class="n">memcached</span><span class="err">&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">类型为</span><span class="n">memcached</span> 
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_PERMANENT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span> <span class="err">#</span> <span class="err">如果设置为</span><span class="n">True</span><span class="err">，则关闭浏览器</span><span class="n">session</span><span class="err">就失效。</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PERMANENT_SESSION_LIFETIME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="cp">#一个持久化的会话的生存时间，是一个datetime.timedelta对象，也可以用一个整数来表示秒,前提设置了PERMANENT_SESSION_LIFETIME为True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_USE_SIGNER</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">False</span> <span class="err">#</span> <span class="err">是否对发送到浏览器上</span><span class="n">session</span><span class="err">的</span><span class="n">cookie</span><span class="err">值进行加密</span><span class="p">,</span><span class="err">默认</span><span class="n">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_KEY_PREFIX</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">flask</span><span class="o">-</span><span class="n">session</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">保存到缓存中的</span><span class="n">key</span><span class="err">的前缀</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_NAME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span> <span class="err">&#39;</span><span class="n">session_id</span><span class="err">&#39;</span>  <span class="err">#</span> <span class="err">保存在浏览器的</span><span class="n">cookie</span><span class="err">名称</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_MEMCACHED</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memcache</span><span class="p">.</span><span class="n">Client</span><span class="p">([</span><span class="err">&#39;</span><span class="mf">10.1.210.33</span><span class="o">:</span><span class="mi">12000</span><span class="err">&#39;</span><span class="p">])</span> <span class="err">#连接</span>


<span class="cp">#其他配置，不经常使用</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_DOMAIN</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">设置</span><span class="n">cookie</span><span class="err">的域名，不建议设置默认为</span><span class="n">server_name</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_PATH</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;/&#39;</span> <span class="err">#</span> <span class="err">会话</span><span class="n">cookie</span><span class="err">的路径。</span> <span class="err">如果未设置，则</span><span class="n">cookie</span><span class="err">将对所有</span><span class="n">url</span><span class="err">有效，默认为</span><span class="sc">&#39;/&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_HTTPONLY</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">True</span> <span class="err">#</span> <span class="err">是否启动</span><span class="n">httponly</span><span class="p">,</span><span class="err">默认为</span><span class="nb">true</span><span class="err">，为了防止</span><span class="n">xss</span><span class="err">脚本访问</span><span class="n">cookie</span>




<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">()</span><span class="o">:</span>
 <span class="n">session</span><span class="p">[</span><span class="s">&quot;username&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;jack&quot;</span>
 <span class="k">return</span> <span class="err">&#39;</span><span class="n">login</span><span class="err">&#39;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
 <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h2 id="filesystem">Filesystem</h2>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
<span class="n">from</span> <span class="n">flask_session</span> <span class="n">import</span> <span class="n">Session</span>
<span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">timedelta</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">adavafa</span><span class="err">&#39;</span>



<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_TYPE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">filesystem</span><span class="err">&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">类型为</span><span class="n">filesystem</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_FILE_DIR</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">db</span><span class="err">&#39;</span> <span class="err">#文件保存目录</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_FILE_THRESHOLD</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span> <span class="err">#</span> <span class="err">存储</span><span class="n">session</span><span class="err">的个数如果大于这个值时，开始删除</span>

<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_PERMANENT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span> <span class="err">#</span> <span class="err">如果设置为</span><span class="n">True</span><span class="err">，则关闭浏览器</span><span class="n">session</span><span class="err">就失效。</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PERMANENT_SESSION_LIFETIME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="cp">#一个持久化的会话的生存时间，是一个datetime.timedelta对象，也可以用一个整数来表示秒,前提设置了PERMANENT_SESSION_LIFETIME为True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_USE_SIGNER</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">False</span> <span class="err">#</span> <span class="err">是否对发送到浏览器上</span><span class="n">session</span><span class="err">的</span><span class="n">cookie</span><span class="err">值进行加密</span><span class="p">,</span><span class="err">默认</span><span class="n">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_KEY_PREFIX</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">flask</span><span class="o">-</span><span class="n">session</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">保存到文件中的</span><span class="n">key</span><span class="err">的前缀</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_NAME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span> <span class="err">&#39;</span><span class="n">session_id</span><span class="err">&#39;</span>  <span class="err">#</span> <span class="err">保存在浏览器的</span><span class="n">cookie</span><span class="err">名称</span>


<span class="cp">#其他配置，不经常使用</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_DOMAIN</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">设置</span><span class="n">cookie</span><span class="err">的域名，不建议设置默认为</span><span class="n">server_name</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_PATH</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;/&#39;</span> <span class="err">#</span> <span class="err">会话</span><span class="n">cookie</span><span class="err">的路径。</span> <span class="err">如果未设置，则</span><span class="n">cookie</span><span class="err">将对所有</span><span class="n">url</span><span class="err">有效，默认为</span><span class="sc">&#39;/&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_HTTPONLY</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">True</span> <span class="err">#</span> <span class="err">是否启动</span><span class="n">httponly</span><span class="p">,</span><span class="err">默认为</span><span class="nb">true</span><span class="err">，为了防止</span><span class="n">xss</span><span class="err">脚本访问</span><span class="n">cookie</span>

<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">()</span><span class="o">:</span>
 <span class="n">session</span><span class="p">[</span><span class="s">&quot;username&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;jack&quot;</span>
 <span class="k">return</span> <span class="err">&#39;</span><span class="n">login</span><span class="err">&#39;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
 <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h2 id="mongodb">mongodb</h2>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">pymongo</span>
<span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
<span class="n">from</span> <span class="n">flask_session</span> <span class="n">import</span> <span class="n">Session</span>
<span class="n">from</span> <span class="n">datetime</span> <span class="n">import</span> <span class="n">timedelta</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">adavafa</span><span class="err">&#39;</span>


<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_TYPE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">mongodb</span><span class="err">&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">类型为</span><span class="n">mongodb</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_MONGODB</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pymongo</span><span class="p">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="err">&#39;</span><span class="n">localhost</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">27017</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_MONGODB_DB</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;数据库名称&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_MONGODB_COLLECT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;表名称&#39;</span>


<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_PERMANENT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span> <span class="err">#</span> <span class="err">如果设置为</span><span class="n">True</span><span class="err">，则关闭浏览器</span><span class="n">session</span><span class="err">就失效。</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PERMANENT_SESSION_LIFETIME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="cp">#一个持久化的会话的生存时间，是一个datetime.timedelta对象，也可以用一个整数来表示秒,前提设置了PERMANENT_SESSION_LIFETIME为True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_USE_SIGNER</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">False</span> <span class="err">#</span> <span class="err">是否对发送到浏览器上</span><span class="n">session</span><span class="err">的</span><span class="n">cookie</span><span class="err">值进行加密</span><span class="p">,</span><span class="err">默认</span><span class="n">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_KEY_PREFIX</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">flask</span><span class="o">-</span><span class="n">session</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">保存的</span><span class="n">session</span><span class="err">的</span><span class="n">key</span><span class="err">的前缀</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_NAME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span> <span class="err">&#39;</span><span class="n">session_id</span><span class="err">&#39;</span>  <span class="err">#</span> <span class="err">保存在浏览器的</span><span class="n">cookie</span><span class="err">名称</span>


<span class="cp">#其他配置，不经常使用</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_DOMAIN</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">设置</span><span class="n">cookie</span><span class="err">的域名，不建议设置默认为</span><span class="n">server_name</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_PATH</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;/&#39;</span> <span class="err">#</span> <span class="err">会话</span><span class="n">cookie</span><span class="err">的路径。</span> <span class="err">如果未设置，则</span><span class="n">cookie</span><span class="err">将对所有</span><span class="n">url</span><span class="err">有效，默认为</span><span class="sc">&#39;/&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_HTTPONLY</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">True</span> <span class="err">#</span> <span class="err">是否启动</span><span class="n">httponly</span><span class="p">,</span><span class="err">默认为</span><span class="nb">true</span><span class="err">，为了防止</span><span class="n">xss</span><span class="err">脚本访问</span><span class="n">cookie</span>

<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">()</span><span class="o">:</span>
 <span class="n">session</span><span class="p">[</span><span class="s">&quot;username&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;jack&quot;</span>
 <span class="k">return</span> <span class="err">&#39;</span><span class="n">login</span><span class="err">&#39;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
 <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h2 id="sqlalchemy">sqlalchemy</h2>
<p>有bug，在断开session会导致字段为空</p>
<div class="hlcode"><pre><span class="n">import</span> <span class="n">redis</span>
<span class="n">from</span> <span class="n">flask</span> <span class="n">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span>
<span class="n">from</span> <span class="n">flask_session</span> <span class="n">import</span> <span class="n">Session</span> 
<span class="n">from</span> <span class="n">flask_sqlalchemy</span> <span class="n">import</span> <span class="n">SQLAlchemy</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">True</span>
<span class="n">app</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">adavafa</span><span class="err">&#39;</span>

<span class="cp"># 设置数据库链接</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SQLALCHEMY_DATABASE_URI</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">mysql</span><span class="o">+</span><span class="n">pymysql</span><span class="o">:</span><span class="c1">//root:dev@127.0.0.1:3306/devops?charset=utf8&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SQLALCHEMY_TRACK_MODIFICATIONS</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span>
<span class="cp"># 实例化SQLAlchemy</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_TYPE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">sqlalchemy</span><span class="err">&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">类型为</span><span class="n">sqlalchemy</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_SQLALCHEMY</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span> <span class="err">#</span> <span class="n">SQLAlchemy</span><span class="err">对象</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_SQLALCHEMY_TABLE</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;表名&#39;</span> <span class="err">#</span> <span class="n">session</span><span class="err">要保存的表名称</span>

<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_PERMANENT</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">True</span> <span class="err">#</span> <span class="err">如果设置为</span><span class="n">True</span><span class="err">，则关闭浏览器</span><span class="n">session</span><span class="err">就失效。</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PERMANENT_SESSION_LIFETIME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="cp">#一个持久化的会话的生存时间，是一个datetime.timedelta对象，也可以用一个整数来表示秒,前提设置了PERMANENT_SESSION_LIFETIME为True</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_USE_SIGNER</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">False</span> <span class="err">#</span> <span class="err">是否对发送到浏览器上</span><span class="n">session</span><span class="err">的</span><span class="n">cookie</span><span class="err">值进行加密</span><span class="p">,</span><span class="err">默认</span><span class="n">False</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_KEY_PREFIX</span><span class="err">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">flask</span><span class="o">-</span><span class="n">session</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">保存的</span><span class="n">session</span><span class="err">的</span><span class="n">key</span><span class="err">的前缀</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_NAME</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span> <span class="err">&#39;</span><span class="n">session_id</span><span class="err">&#39;</span>  <span class="err">#</span> <span class="err">保存在浏览器的</span><span class="n">cookie</span><span class="err">名称</span>


<span class="cp">#其他配置，不经常使用</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_DOMAIN</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span> <span class="err">#</span> <span class="err">设置</span><span class="n">cookie</span><span class="err">的域名，不建议设置默认为</span><span class="n">server_name</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_PATH</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="sc">&#39;/&#39;</span> <span class="err">#</span> <span class="err">会话</span><span class="n">cookie</span><span class="err">的路径。</span> <span class="err">如果未设置，则</span><span class="n">cookie</span><span class="err">将对所有</span><span class="n">url</span><span class="err">有效，默认为</span><span class="sc">&#39;/&#39;</span>
<span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="err">&#39;</span><span class="n">SESSION_COOKIE_HTTPONLY</span><span class="err">&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">True</span> <span class="err">#</span> <span class="err">是否启动</span><span class="n">httponly</span><span class="p">,</span><span class="err">默认为</span><span class="nb">true</span><span class="err">，为了防止</span><span class="n">xss</span><span class="err">脚本访问</span><span class="n">cookie</span>




<span class="n">Session</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="err">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">login</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">index</span><span class="p">()</span><span class="o">:</span>
 <span class="n">session</span><span class="p">[</span><span class="s">&quot;username&quot;</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;jack&quot;</span>
 <span class="k">return</span> <span class="err">&#39;</span><span class="n">login</span><span class="err">&#39;</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="err">&#39;</span><span class="n">__main__</span><span class="err">&#39;</span><span class="o">:</span>
 <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>


<span class="cp">###使用SQLAlchemy时候先确保数据库和表都存在</span>
<span class="err">在命令行中创建表</span>
<span class="cp">#&gt;&gt;&gt; from app import db</span>
<span class="cp">#&gt;&gt;&gt; db.create_all()</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-01-24 16:55:26</p>
      </span>
    </div>

    
    
  </body>
</html>