<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>storage - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Docker">Docker</a>&nbsp;&#187;&nbsp;storage
    <span class="updated">Page Updated&nbsp;
      2019-08-11 12:14
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">storage</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#docker">Docker 数据管理</a><ul>
<li><a href="#_1">数据卷</a><ul>
<li><a href="#_2">创建一个数据卷</a></li>
<li><a href="#_3">查看所有的数据卷</a><ul>
<li><a href="#_4">查看数据卷的具体信息</a></li>
</ul>
</li>
<li><a href="#_5">启动一个挂载数据卷的容器</a></li>
<li><a href="#_6">挂载一个主机目录作为数据卷</a></li>
<li><a href="#_7">挂载一个本地主机文件作为数据卷</a></li>
<li><a href="#_8">删除数据卷</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker-machine">Docker Machine 项目</a><ul>
<li><a href="#_9">安装</a><ul>
<li><a href="#macoswindows">macOS/Windows</a></li>
<li><a href="#linux">Linux</a></li>
</ul>
</li>
<li><a href="#docker-machines">Docker Machines 使用</a><ul>
<li><a href="#_10">本地主机实例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker-swarm">Docker Swarm</a><ul>
<li><a href="#docker-machine_1">Docker Machine</a></li>
<li><a href="#docker-compose">Docker Compose</a></li>
</ul>
</li>
<li><a href="#etcd">etcd</a><ul>
<li><a href="#etcd_1">etcd 安装</a><ul>
<li><a href="#_11">二进制文件方式下载</a></li>
</ul>
</li>
<li><a href="#etcdctl">使用 etcdctl</a><ul>
<li><a href="#_12">数据库操作</a></li>
<li><a href="#_13">非数据库操作</a></li>
<li><a href="#_14">命令选项</a></li>
</ul>
</li>
<li><a href="#_15"></a></li>
</ul>
</li>
</ul>
</div>
<h1 id="docker">Docker 数据管理</h1>
<h2 id="_1">数据卷</h2>
<ul>
<li>数据卷是一个可供一个或多个容器使用的特殊目录</li>
<li>数据卷可以在容器之间共享和重用</li>
<li>对数据卷的修改会立马生效</li>
<li>对数据卷的更新，不会影响镜像</li>
<li>数据卷默认会一直存在，即使容器被删除</li>
</ul>
<blockquote>
<p>注意：数据卷的使用，类似于 Linux 下对目录或文件进行 mount，镜像中的被指定为挂载点的目录中的文件会隐藏掉，能显示看的是挂载的数据卷。</p>
</blockquote>
<h3 id="_2">创建一个数据卷</h3>
<p><code>-v</code></p>
<p><code>-–mount</code></p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">volume</span> <span class="n">create</span> <span class="n">my</span><span class="o">-</span><span class="n">vol</span>
</pre></div>


<h3 id="_3">查看所有的数据卷</h3>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">volume</span> <span class="n">ls</span>

<span class="n">local</span>               <span class="n">my</span><span class="o">-</span><span class="n">vol</span>
</pre></div>


<div class="hlcode"><pre><span class="err">$</span> <span class="nt">docker</span> <span class="nt">volume</span> <span class="nt">inspect</span> <span class="nt">my-vol</span>
<span class="cp">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;Driver&quot;</span><span class="p">:</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Labels&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;Mountpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-vol&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Options&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;Scope&quot;</span><span class="p">:</span> <span class="s2">&quot;local&quot;</span>
    <span class="p">}</span>
<span class="cp">]</span>
</pre></div>


<h4 id="_4">查看数据卷的具体信息</h4>
<p>在主机里使用以下命令可以查看 web 容器的信息</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">inspect</span> <span class="n">web</span>
</pre></div>


<h3 id="_5">启动一个挂载数据卷的容器</h3>
<p>使用 --mount 标记来将数据卷挂载到容器里</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> \
    <span class="o">--</span><span class="n">name</span> <span class="n">web</span> \
    <span class="o">--</span><span class="n">mount</span> <span class="n">source</span><span class="o">=</span><span class="n">my</span><span class="o">-</span><span class="n">vol</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">webapp</span> \
    <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> \
    <span class="n">python</span> <span class="n">app</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<h3 id="_6">挂载一个主机目录作为数据卷</h3>
<p>使用 --mount 标记可以指定挂载一个本地主机的目录到容器中去。</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> \
    <span class="o">--</span><span class="n">name</span> <span class="n">web</span> \
    <span class="err">#</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">webapp</span><span class="o">:/</span><span class="n">opt</span><span class="o">/</span><span class="n">webapp</span> \
    <span class="o">--</span><span class="n">mount</span> <span class="n">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/</span><span class="n">src</span><span class="o">/</span><span class="n">webapp</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">webapp</span> \
    <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> \
    <span class="n">python</span> <span class="n">app</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<p>Docker 挂载主机目录的默认权限是 读写，用户也可以通过增加 readonly 指定为 只读。</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">P</span> \
    <span class="o">--</span><span class="n">name</span> <span class="n">web</span> \
    <span class="err">#</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">webapp</span><span class="o">:/</span><span class="n">opt</span><span class="o">/</span><span class="n">webapp</span><span class="o">:</span><span class="n">ro</span> \
    <span class="o">--</span><span class="n">mount</span> <span class="n">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=/</span><span class="n">src</span><span class="o">/</span><span class="n">webapp</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">webapp</span><span class="p">,</span><span class="n">readonly</span> \
    <span class="n">training</span><span class="o">/</span><span class="n">webapp</span> \
    <span class="n">python</span> <span class="n">app</span><span class="p">.</span><span class="n">py</span>
</pre></div>


<h3 id="_7">挂载一个本地主机文件作为数据卷</h3>
<p>--mount 标记也可以从主机挂载单个文件到容器中</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">it</span> \
   <span class="err">#</span> <span class="o">-</span><span class="n">v</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">bash_history</span><span class="o">:/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">bash_history</span> \
   <span class="o">--</span><span class="n">mount</span> <span class="n">type</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">bash_history</span><span class="p">,</span><span class="n">target</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">bash_history</span> \
   <span class="nl">ubuntu:</span><span class="mf">17.10</span> \
   <span class="n">bash</span>

<span class="n">root</span><span class="err">@</span><span class="mi">2</span><span class="n">affd44b4667</span><span class="o">:/</span><span class="err">#</span> <span class="n">history</span>
<span class="mi">1</span>  <span class="n">ls</span>
<span class="mi">2</span>  <span class="n">diskutil</span> <span class="n">list</span>
</pre></div>


<h3 id="_8">删除数据卷</h3>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">volume</span> <span class="n">rm</span> <span class="n">my</span><span class="o">-</span><span class="n">vol</span>
</pre></div>


<blockquote>
<p>数据卷是被设计用来持久化数据的，它的生命周期独立于容器，Docker 不会在容器被删除后自动删除数据卷，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的数据卷。</p>
</blockquote>
<p>如果需要在删除容器的同时移除数据卷。可以在删除容器的时候使用 docker rm -v 这个命令。</p>
<p>无主的数据卷可能会占据很多空间，要清理请使用以下命令</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span> <span class="n">volume</span> <span class="n">prune</span>
</pre></div>


<h1 id="docker-machine">Docker Machine 项目</h1>
<p>Docker Machine 是 Docker 官方编排（Orchestration）项目之一，负责在多种平台上快速安装 Docker 环境。</p>
<h2 id="_9">安装</h2>
<h3 id="macoswindows">macOS/Windows</h3>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="o">-</span><span class="n">v</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">version</span> <span class="mf">0.13.0</span><span class="p">,</span> <span class="n">build</span> <span class="mi">9</span><span class="n">ba6da9</span>
</pre></div>


<h3 id="linux">Linux</h3>
<div class="hlcode"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/docker/machine/releases/download/v0.13.0/docker-machine-`uname -s`-`uname -m` &gt;/tmp/docker-machine &amp;&amp;</span>
<span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="o">&amp;&amp;</span>
<span class="n">sudo</span> <span class="n">cp</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">machine</span>
</pre></div>


<ul>
<li>完成后，查看版本信息</li>
</ul>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="o">-</span><span class="n">v</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">version</span> <span class="mf">0.13.0</span><span class="p">,</span> <span class="n">build</span> <span class="mi">9</span><span class="n">ba6da9</span>
</pre></div>


<h2 id="docker-machines">Docker Machines 使用</h2>
<ul>
<li>Docker Machine 支持多种后端驱动，包括虚拟机、本地主机和云平台等。</li>
</ul>
<h3 id="_10">本地主机实例</h3>
<ul>
<li>使用 virtualbox 类型的驱动，创建一台 Docker 主机，命名为 test。</li>
</ul>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">-</span><span class="n">d</span> <span class="n">virtualbox</span> <span class="n">test</span>
</pre></div>


<ul>
<li>查看主机</li>
</ul>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">ls</span>

<span class="n">NAME</span>      <span class="n">ACTIVE</span>   <span class="n">DRIVER</span>       <span class="n">STATE</span>     <span class="n">URL</span>                         <span class="n">SWARM</span>   <span class="n">DOCKER</span>       <span class="n">ERRORS</span>
<span class="n">test</span>      <span class="o">-</span>        <span class="n">virtualbox</span>   <span class="n">Running</span>   <span class="n">tcp</span><span class="o">:</span><span class="c1">//192.168.99.187:2376           v17.10.0-ce</span>
</pre></div>


<h1 id="docker-swarm">Docker Swarm</h1>
<p>Docker Swarm 是 Docker 官方三剑客项目之一，提供 Docker 容器集群服务，是 Docker 官方对容器云生态进行支持的核心方案。</p>
<h2 id="docker-machine_1">Docker Machine</h2>
<p>将主机配置成可以加入到Swarm集群中里面</p>
<h2 id="docker-compose">Docker Compose</h2>
<p>仅适合单机的容器编排工具</p>
<h1 id="etcd">etcd</h1>
<p>etcd 是 CoreOS 团队发起的一个管理配置信息和服务发现（service discovery）的项目</p>
<p>etcd 是 CoreOS 团队于 2013 年 6 月发起的开源项目，它的目标是构建一个高可用的分布式键值（key-value）数据库，基于 Go 语言实现。</p>
<p>受到 Apache ZooKeeper 项目和 doozer 项目的启发，etcd 在设计的时候重点考虑了下面四个要素：<br />
简单：支持 REST 风格的 HTTP+JSON API<br />
安全：支持 HTTPS 方式的访问<br />
快速：支持并发 1k/s 的写操作<br />
可靠：支持分布式结构，基于 Raft 的一致性算法</p>
<p>一般情况下，用户使用 etcd 可以在多个节点上启动多个实例，并添加它们为一个集群。同一个集群中的 etcd 实例将会保持彼此信息的一致性。</p>
<h2 id="etcd_1">etcd 安装</h2>
<ul>
<li>etcd 基于 Go 语言实现，因此，用户可以从 项目主页 下载源代码自行编译，也可以下载编译好的二进制文件，甚至直接使用制作好的 Docker 镜像文件来体验。</li>
</ul>
<h3 id="_11">二进制文件方式下载</h3>
<ul>
<li>编译好的二进制文件都在 github.com/coreos/etcd/releases 页面，用户可以选择需要的版本，或通过下载工具下载</li>
</ul>
<div class="hlcode"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">L</span>  <span class="n">https</span><span class="o">:</span><span class="c1">//github.com/coreos/etcd/releases/download/v3.1.11/etcd-v3.1.11-linux-amd64.tar.gz -o etcd-v3.1.11-linux-amd64.tar.gz</span>
<span class="n">tar</span> <span class="n">xzvf</span> <span class="n">etcd</span><span class="o">-</span><span class="n">v3</span><span class="mf">.1.11</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">etcd</span><span class="o">-</span><span class="n">v3</span><span class="mf">.1.11</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
</pre></div>


<ul>
<li>其中 etcd 是服务主文件，etcdctl 是提供给用户的命令客户端，etcd-migrate 负责进行迁移。<br />
  推荐通过下面的命令将三个文件都放到系统可执行目录 /usr/local/bin/ 或 /usr/bin/。</li>
</ul>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">cp</span> <span class="n">etcd</span><span class="o">*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span>
</pre></div>


<ul>
<li>运行 etcd，将默认组建一个两个节点的集群。数据库服务端默认监听在 2379 和 4001 端口，etcd 实例监听在 2380 和 7001 端口。显示类似如下的信息：</li>
</ul>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">nagios</span> <span class="n">etcd</span><span class="o">-</span><span class="n">v3</span><span class="mf">.1.11</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="p">]</span><span class="err">#</span> <span class="n">etcd</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518576</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">etcd</span> <span class="n">Version</span><span class="o">:</span> <span class="mf">3.1.11</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518616</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">Git</span> <span class="n">SHA</span><span class="o">:</span> <span class="mf">960f</span><span class="mi">4604</span><span class="n">b</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518619</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">Go</span> <span class="n">Version</span><span class="o">:</span> <span class="n">go1</span><span class="mf">.8.5</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518622</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">Go</span> <span class="n">OS</span><span class="o">/</span><span class="n">Arch</span><span class="o">:</span> <span class="n">linux</span><span class="o">/</span><span class="n">amd64</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518626</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">setting</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">CPUs</span> <span class="n">to</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">available</span> <span class="n">CPUs</span> <span class="n">is</span> <span class="mi">1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518632</span> <span class="n">W</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">no</span> <span class="n">data</span><span class="o">-</span><span class="n">dir</span> <span class="n">provided</span><span class="p">,</span> <span class="n">using</span> <span class="k">default</span> <span class="n">data</span><span class="o">-</span><span class="n">dir</span> <span class="p">.</span><span class="o">/</span><span class="k">default</span><span class="p">.</span><span class="n">etcd</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.518895</span> <span class="n">I</span> <span class="o">|</span> <span class="n">embed</span><span class="o">:</span> <span class="n">listening</span> <span class="k">for</span> <span class="n">peers</span> <span class="n">on</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2380</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.519026</span> <span class="n">I</span> <span class="o">|</span> <span class="n">embed</span><span class="o">:</span> <span class="n">listening</span> <span class="k">for</span> <span class="n">client</span> <span class="n">requests</span> <span class="n">on</span> <span class="n">localhost</span><span class="o">:</span><span class="mi">2379</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531349</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">name</span> <span class="o">=</span> <span class="k">default</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531370</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">data</span> <span class="n">dir</span> <span class="o">=</span> <span class="k">default</span><span class="p">.</span><span class="n">etcd</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531375</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">member</span> <span class="n">dir</span> <span class="o">=</span> <span class="k">default</span><span class="p">.</span><span class="n">etcd</span><span class="o">/</span><span class="n">member</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531379</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">heartbeat</span> <span class="o">=</span> <span class="mi">100</span><span class="n">ms</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531382</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">election</span> <span class="o">=</span> <span class="mi">1000</span><span class="n">ms</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531385</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">snapshot</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531392</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">advertise</span> <span class="n">client</span> <span class="n">URLs</span> <span class="o">=</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2379</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531396</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">initial</span> <span class="n">advertise</span> <span class="n">peer</span> <span class="n">URLs</span> <span class="o">=</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2380</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.531403</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">initial</span> <span class="n">cluster</span> <span class="o">=</span> <span class="k">default</span><span class="o">=</span><span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2380</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.534043</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">starting</span> <span class="n">member</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">in</span> <span class="n">cluster</span> <span class="n">cdf818194e3a8c32</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.534068</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">became</span> <span class="n">follower</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">0</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.534077</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="n">newRaft</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="p">[</span><span class="n">peers</span><span class="o">:</span> <span class="p">[],</span> <span class="n">term</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">commit</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">applied</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lastindex</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lastterm</span><span class="o">:</span> <span class="mi">0</span><span class="p">]</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.534082</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">became</span> <span class="n">follower</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.543383</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">starting</span> <span class="n">server</span><span class="p">...</span> <span class="p">[</span><span class="n">version</span><span class="o">:</span> <span class="mf">3.1.11</span><span class="p">,</span> <span class="n">cluster</span> <span class="n">version</span><span class="o">:</span> <span class="n">to_be_decided</span><span class="p">]</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.544244</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">/</span><span class="n">membership</span><span class="o">:</span> <span class="n">added</span> <span class="n">member</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="p">[</span><span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2380] to cluster cdf818194e3a8c32</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.734379</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">is</span> <span class="n">starting</span> <span class="n">a</span> <span class="n">new</span> <span class="n">election</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.734472</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">became</span> <span class="n">candidate</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">2</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.734490</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">received</span> <span class="n">MsgVoteResp</span> <span class="n">from</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">2</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.734505</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">became</span> <span class="n">leader</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">2</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.734512</span> <span class="n">I</span> <span class="o">|</span> <span class="n">raft</span><span class="o">:</span> <span class="n">raft</span><span class="p">.</span><span class="n">node</span><span class="o">:</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">elected</span> <span class="n">leader</span> <span class="mf">8e9</span><span class="n">e05c52164694d</span> <span class="n">at</span> <span class="n">term</span> <span class="mi">2</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.735011</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">setting</span> <span class="n">up</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">cluster</span> <span class="n">version</span> <span class="n">to</span> <span class="mf">3.1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.735063</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">:</span> <span class="n">published</span> <span class="p">{</span><span class="n">Name</span><span class="o">:</span><span class="k">default</span> <span class="n">ClientURLs</span><span class="o">:</span><span class="p">[</span><span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2379]} to cluster cdf818194e3a8c32</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.735155</span> <span class="n">E</span> <span class="o">|</span> <span class="n">etcdmain</span><span class="o">:</span> <span class="n">forgot</span> <span class="n">to</span> <span class="n">set</span> <span class="n">Type</span><span class="o">=</span><span class="n">notify</span> <span class="n">in</span> <span class="n">systemd</span> <span class="n">service</span> <span class="n">file</span><span class="o">?</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.735163</span> <span class="n">I</span> <span class="o">|</span> <span class="n">embed</span><span class="o">:</span> <span class="n">ready</span> <span class="n">to</span> <span class="n">serve</span> <span class="n">client</span> <span class="n">requests</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.735380</span> <span class="n">N</span> <span class="o">|</span> <span class="n">embed</span><span class="o">:</span> <span class="n">serving</span> <span class="n">insecure</span> <span class="n">client</span> <span class="n">requests</span> <span class="n">on</span> <span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">2379</span><span class="p">,</span> <span class="n">this</span> <span class="n">is</span> <span class="n">strongly</span> <span class="n">discouraged</span><span class="o">!</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.737414</span> <span class="n">N</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">/</span><span class="n">membership</span><span class="o">:</span> <span class="n">set</span> <span class="n">the</span> <span class="n">initial</span> <span class="n">cluster</span> <span class="n">version</span> <span class="n">to</span> <span class="mf">3.1</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mf">04.737465</span> <span class="n">I</span> <span class="o">|</span> <span class="n">etcdserver</span><span class="o">/</span><span class="n">api</span><span class="o">:</span> <span class="n">enabled</span> <span class="n">capabilities</span> <span class="k">for</span> <span class="n">version</span> <span class="mf">3.1</span>
</pre></div>


<ul>
<li>可以使用 etcdctl 命令进行测试</li>
<li>说明 etcd 服务已经成功启动了</li>
</ul>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">nagios</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">etcdctl</span>  <span class="n">set</span> <span class="n">testkey</span> <span class="err">&#39;</span><span class="n">helloworld</span><span class="err">&#39;</span>
<span class="n">helloworld</span>
<span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">nagios</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">etcdctl</span> <span class="n">get</span> <span class="n">testkey</span>
<span class="n">helloworld</span>
</pre></div>


<ul>
<li>也可以通过 HTTP 访问本地 2379 或 4001 端口的方式来进行操作，例如查看 testkey 的值：</li>
</ul>
<div class="hlcode"><pre><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">nagios</span> <span class="o">~</span><span class="p">]</span><span class="err">#</span> <span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:2379/v2/keys/testkey</span>
<span class="p">{</span><span class="s">&quot;action&quot;</span><span class="o">:</span><span class="s">&quot;get&quot;</span><span class="p">,</span><span class="s">&quot;node&quot;</span><span class="o">:</span><span class="p">{</span><span class="s">&quot;key&quot;</span><span class="o">:</span><span class="s">&quot;/testkey&quot;</span><span class="p">,</span><span class="s">&quot;value&quot;</span><span class="o">:</span><span class="s">&quot;helloworld&quot;</span><span class="p">,</span><span class="s">&quot;modifiedIndex&quot;</span><span class="o">:</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;createdIndex&quot;</span><span class="o">:</span><span class="mi">4</span><span class="p">}}</span>
</pre></div>


<h2 id="etcdctl">使用 etcdctl</h2>
<ul>
<li>etcdctl 是一个命令行客户端，它能提供一些简洁的命令，供用户直接跟 etcd 服务打交道，而无需基于 HTTP API 方式。这在某些情况下将很方便，例如用户对服务进行测试或者手动修改数据库内容。我们也推荐在刚接触 etcd 时通过 etcdctl 命令来熟悉相关的操作，这些操作跟 HTTP API 实际上是对应的。</li>
</ul>
<h3 id="_12">数据库操作</h3>
<ul>
<li>数据库操作围绕对键值和目录的 CRUD （符合 REST 风格的一套操作：Create）完整生命周期的管理。<br />
  etcd 在键的组织上采用了层次化的空间结构（类似于文件系统中目录的概念），用户指定的键可以为单独的名字，如 testkey，此时实际上放在根目录 / 下面，也可以为指定目录结构，如 cluster1/node2/testkey，则将创建相应的目录结构。</li>
</ul>
<div class="hlcode"><pre><span class="n">set</span>

<span class="err">指定某个键的值。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">set</span> <span class="o">/</span><span class="n">testdir</span><span class="o">/</span><span class="n">testkey</span> <span class="s">&quot;Hello world&quot;</span>
<span class="n">Hello</span> <span class="n">world</span>
<span class="err">支持的选项包括：</span>

<span class="o">--</span><span class="n">ttl</span> <span class="sc">&#39;0&#39;</span>            <span class="err">该键值的超时时间（单位为秒），不配置（默认为</span> <span class="mi">0</span><span class="err">）则永不超时</span>
<span class="o">--</span><span class="n">swap</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">value</span> <span class="n">value</span> <span class="err">若该键现在的值是</span> <span class="n">value</span><span class="err">，则进行设置操作</span>
<span class="o">--</span><span class="n">swap</span><span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">index</span> <span class="sc">&#39;0&#39;</span>    <span class="err">若该键现在的索引值是指定索引，则进行设置操作</span>
<span class="n">get</span>

<span class="err">获取指定键的值。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">set</span> <span class="n">testkey</span> <span class="n">hello</span>
<span class="n">hello</span>
<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">update</span> <span class="n">testkey</span> <span class="n">world</span>
<span class="n">world</span>
<span class="err">当键不存在时，则会报错。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">get</span> <span class="n">testkey2</span>
<span class="nl">Error:</span>  <span class="mi">100</span><span class="o">:</span> <span class="n">Key</span> <span class="n">not</span> <span class="n">found</span> <span class="p">(</span><span class="o">/</span><span class="n">testkey2</span><span class="p">)</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">sort</span>    <span class="err">对结果进行排序</span>
<span class="o">--</span><span class="n">consistent</span> <span class="err">将请求发给主节点，保证获取内容的一致性</span>
<span class="n">update</span>

<span class="err">当键存在时，更新值内容。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">set</span> <span class="n">testkey</span> <span class="n">hello</span>
<span class="n">hello</span>
<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">update</span> <span class="n">testkey</span> <span class="n">world</span>
<span class="n">world</span>
<span class="err">当键不存在时，则会报错。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">update</span> <span class="n">testkey2</span> <span class="n">world</span>
<span class="nl">Error:</span>  <span class="mi">100</span><span class="o">:</span> <span class="n">Key</span> <span class="n">not</span> <span class="n">found</span> <span class="p">(</span><span class="o">/</span><span class="n">testkey2</span><span class="p">)</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">ttl</span> <span class="sc">&#39;0&#39;</span>    <span class="err">超时时间（单位为秒），不配置（默认为</span> <span class="mi">0</span><span class="err">）则永不超时</span>
<span class="n">rm</span>

<span class="err">删除某个键值。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">rm</span> <span class="n">testkey</span>
<span class="err">当键不存在时，则会报错。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">rm</span> <span class="n">testkey2</span>
<span class="nl">Error:</span>  <span class="mi">100</span><span class="o">:</span> <span class="n">Key</span> <span class="n">not</span> <span class="n">found</span> <span class="p">(</span><span class="o">/</span><span class="n">testkey2</span><span class="p">)</span> <span class="p">[</span><span class="mi">8</span><span class="p">]</span>
<span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">dir</span>        <span class="err">如果键是个空目录或者键值对则删除</span>
<span class="o">--</span><span class="n">recursive</span>        <span class="err">删除目录和所有子键</span>
<span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">value</span>     <span class="err">检查现有的值是否匹配</span>
<span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">index</span> <span class="sc">&#39;0&#39;</span>    <span class="err">检查现有的</span> <span class="n">index</span> <span class="err">是否匹配</span>
<span class="n">mk</span>

<span class="err">如果给定的键不存在，则创建一个新的键值。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">mk</span> <span class="o">/</span><span class="n">testdir</span><span class="o">/</span><span class="n">testkey</span> <span class="s">&quot;Hello world&quot;</span>
<span class="n">Hello</span> <span class="n">world</span>
<span class="err">当键存在的时候，执行该命令会报错，例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">set</span> <span class="n">testkey</span> <span class="s">&quot;Hello world&quot;</span>
<span class="n">Hello</span> <span class="n">world</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">etcdctl</span> <span class="n">mk</span> <span class="n">testkey</span> <span class="s">&quot;Hello world&quot;</span>
<span class="nl">Error:</span>  <span class="mi">105</span><span class="o">:</span> <span class="n">Key</span> <span class="n">already</span> <span class="n">exists</span> <span class="p">(</span><span class="o">/</span><span class="n">testkey</span><span class="p">)</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">ttl</span> <span class="sc">&#39;0&#39;</span>    <span class="err">超时时间（单位为秒），不配置（默认为</span> <span class="mi">0</span><span class="err">）则永不超时</span>
<span class="n">mkdir</span>

<span class="err">如果给定的键目录不存在，则创建一个新的键目录。例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">mkdir</span> <span class="n">testdir</span>
<span class="err">当键目录存在的时候，执行该命令会报错，例如</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">mkdir</span> <span class="n">testdir</span>
<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">mkdir</span> <span class="n">testdir</span>
<span class="nl">Error:</span>  <span class="mi">105</span><span class="o">:</span> <span class="n">Key</span> <span class="n">already</span> <span class="n">exists</span> <span class="p">(</span><span class="o">/</span><span class="n">testdir</span><span class="p">)</span> <span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">ttl</span> <span class="sc">&#39;0&#39;</span>    <span class="err">超时时间（单位为秒），不配置（默认为</span> <span class="mi">0</span><span class="err">）则永不超时</span>
<span class="n">setdir</span>

<span class="err">创建一个键目录，无论存在与否。</span>

<span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">ttl</span> <span class="sc">&#39;0&#39;</span>    <span class="err">超时时间（单位为秒），不配置（默认为</span> <span class="mi">0</span><span class="err">）则永不超时</span>
<span class="n">updatedir</span>

<span class="err">更新一个已经存在的目录。</span> <span class="err">支持的选项为</span>

<span class="o">--</span><span class="n">ttl</span> <span class="sc">&#39;0&#39;</span>    <span class="err">超时时间（单位为秒），不配置（默认为</span> <span class="mi">0</span><span class="err">）则永不超时</span>
<span class="n">rmdir</span>

<span class="err">删除一个空目录，或者键值对。</span>

<span class="err">若目录不空，会报错</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">set</span> <span class="o">/</span><span class="n">dir</span><span class="o">/</span><span class="n">testkey</span> <span class="n">hi</span>
<span class="n">hi</span>
<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">rmdir</span> <span class="o">/</span><span class="n">dir</span>
<span class="nl">Error:</span>  <span class="mi">108</span><span class="o">:</span> <span class="n">Directory</span> <span class="n">not</span> <span class="n">empty</span> <span class="p">(</span><span class="o">/</span><span class="n">dir</span><span class="p">)</span> <span class="p">[</span><span class="mi">13</span><span class="p">]</span>
<span class="n">ls</span>

<span class="err">列出目录（默认为根目录）下的键或者子目录，默认不显示子目录中内容。</span>

<span class="err">例如</span>

<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">etcdctl</span> <span class="n">set</span> <span class="n">testkey</span> <span class="err">&#39;</span><span class="n">hi</span><span class="err">&#39;</span>
<span class="n">hi</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">etcdctl</span> <span class="n">set</span> <span class="n">dir</span><span class="o">/</span><span class="n">test</span> <span class="err">&#39;</span><span class="n">hello</span><span class="err">&#39;</span>
<span class="n">hello</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">etcdctl</span> <span class="n">ls</span>
<span class="o">/</span><span class="n">testkey</span>
<span class="o">/</span><span class="n">dir</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">etcdctl</span> <span class="n">ls</span> <span class="n">dir</span>
<span class="o">/</span><span class="n">dir</span><span class="o">/</span><span class="n">test</span>
<span class="err">支持的选项包括</span>

<span class="o">--</span><span class="n">sort</span>    <span class="err">将输出结果排序</span>
<span class="o">--</span><span class="n">recursive</span>    <span class="err">如果目录下有子目录，则递归输出其中的内容</span>
<span class="o">-</span><span class="n">p</span>        <span class="err">对于输出为目录，在最后添加</span> <span class="err">`</span><span class="o">/</span><span class="err">`</span> <span class="err">进行区分</span>
</pre></div>


<h3 id="_13">非数据库操作</h3>
<div class="hlcode"><pre><span class="n">backup</span>

<span class="err">备份</span> <span class="n">etcd</span> <span class="err">的数据。</span>

<span class="err">支持的选项包括</span>

<span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">dir</span>         <span class="n">etcd</span> <span class="err">的数据目录</span>
<span class="o">--</span><span class="n">backup</span><span class="o">-</span><span class="n">dir</span>     <span class="err">备份到指定路径</span>
<span class="n">watch</span>

<span class="err">监测一个键值的变化，一旦键值发生更新，就会输出最新的值并退出。</span>

<span class="err">例如，用户更新</span> <span class="n">testkey</span> <span class="err">键值为</span> <span class="n">Hello</span> <span class="n">world</span><span class="err">。</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">watch</span> <span class="n">testkey</span>
<span class="n">Hello</span> <span class="n">world</span>
<span class="err">支持的选项包括</span>

<span class="o">--</span><span class="n">forever</span>        <span class="err">一直监测，直到用户按</span> <span class="err">`</span><span class="n">CTRL</span><span class="o">+</span><span class="n">C</span><span class="err">`</span> <span class="err">退出</span>
<span class="o">--</span><span class="n">after</span><span class="o">-</span><span class="n">index</span> <span class="sc">&#39;0&#39;</span>    <span class="err">在指定</span> <span class="n">index</span> <span class="err">之前一直监测</span>
<span class="o">--</span><span class="n">recursive</span>        <span class="err">返回所有的键值和子键值</span>
<span class="n">exec</span><span class="o">-</span><span class="n">watch</span>

<span class="err">监测一个键值的变化，一旦键值发生更新，就执行给定命令。</span>

<span class="err">例如，用户更新</span> <span class="n">testkey</span> <span class="err">键值。</span>

<span class="err">$</span><span class="n">etcdctl</span> <span class="n">exec</span><span class="o">-</span><span class="n">watch</span> <span class="n">testkey</span> <span class="o">--</span> <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="err">&#39;</span><span class="n">ls</span><span class="err">&#39;</span>
<span class="k">default</span><span class="p">.</span><span class="n">etcd</span>
<span class="n">Documentation</span>
<span class="n">etcd</span>
<span class="n">etcdctl</span>
<span class="n">etcd</span><span class="o">-</span><span class="n">migrate</span>
<span class="n">README</span><span class="o">-</span><span class="n">etcdctl</span><span class="p">.</span><span class="n">md</span>
<span class="n">README</span><span class="p">.</span><span class="n">md</span>
<span class="err">支持的选项包括</span>

<span class="o">--</span><span class="n">after</span><span class="o">-</span><span class="n">index</span> <span class="sc">&#39;0&#39;</span>    <span class="err">在指定</span> <span class="n">index</span> <span class="err">之前一直监测</span>
<span class="o">--</span><span class="n">recursive</span>        <span class="err">返回所有的键值和子键值</span>
<span class="n">member</span>

<span class="err">通过</span> <span class="n">list</span><span class="err">、</span><span class="n">add</span><span class="err">、</span><span class="n">remove</span> <span class="err">命令列出、添加、删除</span> <span class="n">etcd</span> <span class="err">实例到</span> <span class="n">etcd</span> <span class="err">集群中。</span>

<span class="err">例如本地启动一个</span> <span class="n">etcd</span> <span class="err">服务实例后，可以用如下命令进行查看。</span>

<span class="err">$</span> <span class="n">etcdctl</span> <span class="n">member</span> <span class="n">list</span>
<span class="nl">ce2a822cea30bfca:</span> <span class="n">name</span><span class="o">=</span><span class="k">default</span> <span class="n">peerURLs</span><span class="o">=</span><span class="n">http</span><span class="o">:</span><span class="c1">//localhost:2380,http://localhost:7001 clientURLs=http://localhost:2379,http://localhost:4001</span>
</pre></div>


<h3 id="_14">命令选项</h3>
<div class="hlcode"><pre><span class="o">--</span><span class="n">debug</span> <span class="err">输出</span> <span class="n">cURL</span> <span class="err">命令，显示执行命令的时候发起的请求</span>
<span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">sync</span> <span class="err">发出请求之前不同步集群信息</span>
<span class="o">--</span><span class="n">output</span><span class="p">,</span> <span class="o">-</span><span class="n">o</span> <span class="err">&#39;</span><span class="n">simple</span><span class="err">&#39;</span> <span class="err">输出内容的格式</span> <span class="p">(</span><span class="n">simple</span> <span class="err">为原始信息，</span><span class="n">json</span> <span class="err">为进行</span><span class="n">json</span><span class="err">格式解码，易读性好一些</span><span class="p">)</span>
<span class="o">--</span><span class="n">peers</span><span class="p">,</span> <span class="o">-</span><span class="n">C</span> <span class="err">指定集群中的同伴信息，用逗号隔开</span> <span class="p">(</span><span class="err">默认为</span><span class="o">:</span> <span class="s">&quot;127.0.0.1:4001&quot;</span><span class="p">)</span>
<span class="o">--</span><span class="n">cert</span><span class="o">-</span><span class="n">file</span> <span class="n">HTTPS</span> <span class="err">下客户端使用的</span> <span class="n">SSL</span> <span class="err">证书文件</span>
<span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="n">file</span> <span class="n">HTTPS</span> <span class="err">下客户端使用的</span> <span class="n">SSL</span> <span class="err">密钥文件</span>
<span class="o">--</span><span class="n">ca</span><span class="o">-</span><span class="n">file</span> <span class="err">服务端使用</span> <span class="n">HTTPS</span> <span class="err">时，使用</span> <span class="n">CA</span> <span class="err">文件进行验证</span>
<span class="o">--</span><span class="n">help</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span> <span class="err">显示帮助命令信息</span>
<span class="o">--</span><span class="n">version</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span> <span class="err">打印版本信息</span>
</pre></div>


<h2 id="_15"></h2>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-08-18 17:28:02</p>
      </span>
    </div>

    
    
  </body>
</html>