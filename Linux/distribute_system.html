<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>distribute_system 分布式系统 - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Linux">Linux</a>&nbsp;&#187;&nbsp;distribute_system 分布式系统
    <span class="updated">Page Updated&nbsp;
      2019-02-11 21:06
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">distribute_system 分布式系统</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">分布式系统</a><ul>
<li><a href="#_2">特点</a></li>
<li><a href="#_3">多线程编程</a></li>
<li><a href="#io">网络IO</a><ul>
<li><a href="#_4">多进程</a></li>
<li><a href="#_5">多线程</a></li>
<li><a href="#socket">socket 通信开发</a><ul>
<li><a href="#bio">BIO</a></li>
<li><a href="#nio">NIO</a></li>
<li><a href="#aio">AIO</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_6">控制器</a><ul>
<li><a href="#_7">实现模型</a><ul>
<li><a href="#_8">透明代理</a></li>
<li><a href="#_9">旁路代理</a></li>
<li><a href="#_10">名称服务</a></li>
<li><a href="#_11">规则服务</a></li>
<li><a href="#masterslave">Master/Slave 机制</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_12">运算器</a></li>
<li><a href="#_13">存储器</a></li>
<li><a href="#_14">缓存解决方案</a><ul>
<li><a href="#_15">页面缓存</a></li>
<li><a href="#_16">数据缓存</a></li>
</ul>
</li>
<li><a href="#_17">数据主库压力</a><ul>
<li><a href="#_18">数据库拆分</a><ul>
<li><a href="#_19">垂直拆分</a></li>
<li><a href="#_20">水平拆分</a></li>
<li><a href="#_21">分布式事务实现</a><ul>
<li><a href="#_22">模型及规范</a><ul>
<li><a href="#cap">CAP</a></li>
<li><a href="#baseapc">Base模型（加强A和P，在C妥协）</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#nosql">NoSQL 非关系存储</a></li>
<li><a href="#dfs">DFS 非结构化数据</a></li>
<li><a href="#_23">异步： 解耦</a><ul>
<li><a href="#_24">消息中间件</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_1">分布式系统</h1>
<h2 id="_2">特点</h2>
<p>系统各个组件分布于网络上的多个计算机</p>
<p>各个组件彼此之间仅仅通过消息传递垃圾通信并协调行动</p>
<h2 id="_3">多线程编程</h2>
<p>多CPU处理</p>
<p>互不通信的线程模型</p>
<p>基于共享容器协同工作的模型</p>
<p>通过事件协调的多线程模型</p>
<h2 id="io">网络IO</h2>
<h3 id="_4">多进程</h3>
<p>每个线程响应一个请求</p>
<h3 id="_5">多线程</h3>
<p>包括 多进程，每个进行生产多个线程，每线程响应一个用户请求</p>
<p>或没线程直接响应多个请求</p>
<h3 id="socket">socket 通信开发</h3>
<h4 id="bio">BIO</h4>
<p>Blocking IO </p>
<p>一个进程或者一个线程处理一个请求</p>
<h4 id="nio">NIO</h4>
<p>Nonblocking IO </p>
<p>基于事件驱动(epoll) 思想，采用Reactor模式</p>
<h4 id="aio">AIO</h4>
<p>Async IO</p>
<p>基于事件驱动思想，采用Proactor模式</p>
<h1 id="_6">控制器</h1>
<h2 id="_7">实现模型</h2>
<h3 id="_8">透明代理</h3>
<p>lvs的NAT</p>
<p>haproxy， nginx</p>
<h3 id="_9">旁路代理</h3>
<p>请求经过中心控制器，响应直接返回源请求</p>
<h3 id="_10">名称服务</h3>
<h3 id="_11">规则服务</h3>
<p>中心结点为规则服务器，</p>
<h3 id="masterslave">Master/Slave 机制</h3>
<p>如MySQL 主从复制同步</p>
<h1 id="_12">运算器</h1>
<p>即backend</p>
<h1 id="_13">存储器</h1>
<h1 id="_14">缓存解决方案</h1>
<h2 id="_15">页面缓存</h2>
<p>可以使用 varnish squid</p>
<h2 id="_16">数据缓存</h2>
<p>key-value store: memcached</p>
<h1 id="_17">数据主库压力</h1>
<h2 id="_18">数据库拆分</h2>
<h3 id="_19">垂直拆分</h3>
<p>读压力分散, 即主从同步读写分离</p>
<p>把数据库中不同的业务的数据拆分到不同的数据库中</p>
<p>但是单机的ACID保证被打破，要么放弃事务，要么引入分布式事务</p>
<p>一些join查询操作将变的非常困难</p>
<p>原来依赖于外键实现的约束将无从保证</p>
<h3 id="_20">水平拆分</h3>
<p>写压力分散， 需要规则服务器保证不同数据的同步</p>
<p>把一个单独的表中的数据拆分到多个不同的数据库服务器上</p>
<p>但是单机的ACID保证被打破，要么放弃事务，要么引入分布式事务</p>
<p>一些join查询操作将变的非常困难</p>
<p>原来依赖于外键实现的约束将无从保证</p>
<p>自增序列的ID号的产生会有影响</p>
<p>针对单张表的查询很有可能要跨库操作</p>
<h3 id="_21">分布式事务实现</h3>
<p>包括事务参与者，支持事务的服务器，资源服务器，事务管理器</p>
<h4 id="_22">模型及规范</h4>
<p>X/Open： XA（分布式事务的规范）</p>
<p>DTP定义三个组件</p>
<div class="hlcode"><pre><span class="n">AP</span><span class="err">：</span> <span class="err">应用程序，即使用</span><span class="n">DTP</span><span class="err">模型的程序</span>
<span class="n">RM</span><span class="err">：</span> <span class="err">资源管理器，即</span><span class="n">DBMS</span><span class="err">系统</span>
<span class="n">TM</span><span class="err">：</span> <span class="err">事务管理器，负责协调和管理条例，提供给</span><span class="n">AP</span><span class="err">应用程序编程接口并管理资源管理器</span>
</pre></div>


<h5 id="cap">CAP</h5>
<p>任何一种分布式系统最多只能同时满足三项中的两项</p>
<div class="hlcode"><pre><span class="n">Consistency</span><span class="o">:</span> <span class="err">任何一个读取操作总是能够读取之前完成的写操作</span>

<span class="n">Availablity</span><span class="err">：每次操作总是能够在确定的时间返回</span>

<span class="n">Tolerance</span> <span class="n">of</span> <span class="n">network</span> <span class="n">Partition</span><span class="err">：在出现网络分区的情况下，仍然可以满足一致性和可用性</span>
</pre></div>


<p>AP： 放弃C，大多数分布式系统都选择此项</p>
<p>CA： 放弃P</p>
<p>CP：</p>
<h5 id="baseapc">Base模型（加强A和P，在C妥协）</h5>
<p>Basically Available</p>
<p>Soft state： 接受一段时间内的状态不同步</p>
<p>Eventually Consistent：最终一致性</p>
<h1 id="nosql">NoSQL 非关系存储</h1>
<p>文档数据库</p>
<p>列式数据库</p>
<h1 id="dfs">DFS 非结构化数据</h1>
<p>TFS，MogileFS：适用于海量小文件</p>
<p>HDFS，GFS：少量大文件</p>
<h1 id="_23">异步： 解耦</h1>
<h2 id="_24">消息中间件</h2>
<p>MOM: Message-oriented middleware</p>
<p>在你分布式系统中，完成消息发送和接受的基础性软件</p>
<p>消息队列: RabbitMQ, ActiveMQ, ZMQ</p>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2019 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2019-12-16 08:46:05</p>
      </span>
    </div>

    
    
  </body>
</html>