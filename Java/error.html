<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>error - Xu XueHua</title>
    <meta name="keywords" content="Xu XueHua"/>
    <meta name="description" content="Xu XueHua's public notes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Java">Java</a>&nbsp;&#187;&nbsp;error
    <span class="updated">Page Updated&nbsp;
      2019-10-21 22:17
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">error</div>

  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">异常处理</a><ul>
<li><a href="#_2">获取调用失败</a></li>
<li><a href="#_3">继承关系</a><ul>
<li><a href="#error">Error</a></li>
<li><a href="#exception">Exception</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_4">捕获异常</a><ul>
<li><a href="#catch">多catch语句</a></li>
<li><a href="#finally">finally语句</a></li>
<li><a href="#_5">捕获多种异常</a></li>
<li><a href="#printstacktrace">printStackTrace() 异常调用栈</a></li>
<li><a href="#throwablegetcause">Throwable.getCause() 获取原始异常</a></li>
</ul>
</li>
<li><a href="#throw">throw 抛出异常</a></li>
<li><a href="#_6">异常屏蔽 (不常用)</a><ul>
<li><a href="#_7">获知所有的异常</a></li>
</ul>
</li>
<li><a href="#_8">自定义异常</a><ul>
<li><a href="#_9">异常继承</a></li>
</ul>
</li>
<li><a href="#assertion">断言 Assertion (不常用)</a><ul>
<li><a href="#_10">开启</a></li>
<li><a href="#assertionerror">AssertionError</a></li>
<li><a href="#_11">应用场景</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="_1">异常处理</h1>
<h2 id="_2">获取调用失败</h2>
<p>方法一：约定返回错误码。</p>
<p>例如，处理一个文件，如果返回<code>0</code>，表示成功，返回其他整数，表示约定的错误码：</p>
<div class="hlcode"><pre><span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="n">processFile</span><span class="p">(</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">test.txt&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ok:</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// error:</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span>:
        <span class="c1">// file not found:</span>
    <span class="k">case</span> <span class="mi">2</span>:
        <span class="c1">// no read permission:</span>
    <span class="nl">default:</span>
        <span class="c1">// unknown error:</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>方法二：在语言层面上提供一个异常处理机制。</p>
<p>Java内置了一套异常处理机制，总是使用异常来表示错误。</p>
<p>异常是一种<code>class</code>，因此它本身带有类型信息。异常可以在任何地方抛出，但只需要在上层捕获，这样就和方法调用分离了：</p>
<div class="hlcode"><pre><span class="n">try</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">processFile</span><span class="p">(</span><span class="err">“</span><span class="n">C</span><span class="o">:</span><span class="err">\\</span><span class="n">test</span><span class="p">.</span><span class="n">txt</span><span class="err">”</span><span class="p">);</span>
    <span class="c1">// ok:</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">FileNotFoundException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// file not found:</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">SecurityException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// no read permission:</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// io error:</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// other error:</span>
<span class="p">}</span>
</pre></div>


<h2 id="_3">继承关系</h2>
<div class="hlcode"><pre>                     <span class="err">┌───────────┐</span>
                     <span class="err">│</span>  <span class="n">Object</span>   <span class="err">│</span>
                     <span class="err">└───────────┘</span>
                           <span class="err">▲</span>
                           <span class="err">│</span>
                     <span class="err">┌───────────┐</span>
                     <span class="err">│</span> <span class="n">Throwable</span> <span class="err">│</span>
                     <span class="err">└───────────┘</span>
                           <span class="err">▲</span>
                 <span class="err">┌─────────┴─────────┐</span>
                 <span class="err">│</span>                   <span class="err">│</span>
           <span class="err">┌───────────┐</span>       <span class="err">┌───────────┐</span>
           <span class="err">│</span>   <span class="n">Error</span>   <span class="err">│</span>       <span class="err">│</span> <span class="n">Exception</span> <span class="err">│</span>
           <span class="err">└───────────┘</span>       <span class="err">└───────────┘</span>
                 <span class="err">▲</span>                   <span class="err">▲</span>
         <span class="err">┌───────┘</span>              <span class="err">┌────┴──────────┐</span>
         <span class="err">│</span>                      <span class="err">│</span>               <span class="err">│</span>
<span class="err">┌─────────────────┐</span>    <span class="err">┌─────────────────┐┌───────────┐</span>
<span class="err">│</span><span class="n">OutOfMemoryError</span> <span class="err">│</span><span class="p">...</span> <span class="err">│</span><span class="n">RuntimeException</span> <span class="err">││</span><span class="n">IOException</span><span class="err">│</span><span class="p">...</span>
<span class="err">└─────────────────┘</span>    <span class="err">└─────────────────┘└───────────┘</span>
                                <span class="err">▲</span>
                    <span class="err">┌───────────┴─────────────┐</span>
                    <span class="err">│</span>                         <span class="err">│</span>
         <span class="err">┌─────────────────────┐</span> <span class="err">┌─────────────────────────┐</span>
         <span class="err">│</span><span class="n">NullPointerException</span> <span class="err">│</span> <span class="err">│</span><span class="n">IllegalArgumentException</span> <span class="err">│</span><span class="p">...</span>
         <span class="err">└─────────────────────┘</span> <span class="err">└─────────────────────────┘</span>
</pre></div>


<h3 id="error">Error</h3>
<p><code>Error</code>表示严重的错误，程序对此一般无能为力，例如：</p>
<ul>
<li><code>OutOfMemoryError</code>：内存耗尽</li>
<li><code>NoClassDefFoundError</code>：无法加载某个Class</li>
<li><code>StackOverflowError</code>：栈溢出</li>
</ul>
<h3 id="exception">Exception</h3>
<p><code>Exception</code>则是运行时的错误，它可以被捕获并处理。</p>
<p>某些异常是应用程序逻辑处理的一部分，应该捕获并处理。例如：</p>
<ul>
<li><code>NumberFormatException</code>：数值类型的格式错误</li>
<li><code>FileNotFoundException</code>：未找到文件</li>
<li><code>SocketException</code>：读取网络失败</li>
</ul>
<p>还有一些异常是程序逻辑编写不对造成的，应该修复程序本身。例如：</p>
<ul>
<li><code>NullPointerException</code>：对某个<code>null</code>的对象调用方法或字段</li>
<li><code>IndexOutOfBoundsException</code>：数组索引越界</li>
</ul>
<p><code>Exception</code>又分为两大类：</p>
<ol>
<li><code>RuntimeException</code>以及它的子类；</li>
<li>非<code>RuntimeException</code>（包括<code>IOException</code>、<code>ReflectiveOperationException</code>等等）</li>
</ol>
<p>Java规定：</p>
<ul>
<li>必须捕获的异常，包括<code>Exception</code>及其子类，但不包括<code>RuntimeException</code>及其子类，这种类型的异常称为Checked Exception。</li>
<li>不需要捕获的异常，包括<code>Error</code>及其子类，<code>RuntimeException</code>及其子类</li>
</ul>
<h1 id="_4">捕获异常</h1>
<p>捕获异常使用<code>try...catch</code>语句，把可能发生异常的代码放到<code>try {...}</code>中，然后使用<code>catch</code>捕获对应的<code>Exception</code>及其子类</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">Main</span> <span class="p">{</span>
    <span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">byte</span><span class="p">[]</span> <span class="n">bs</span> <span class="o">=</span> <span class="n">toGBK</span><span class="p">(</span><span class="s">&quot;中文&quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">Arrays</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">bs</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">toGBK</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">try</span> <span class="p">{</span>
            <span class="c1">// 用指定编码转换String为byte[]:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">getBytes</span><span class="p">(</span><span class="s">&quot;GBK&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 如果系统不支持GBK编码，会捕获到UnsupportedEncodingException:</span>
            <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="c1">// 打印异常信息</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">getBytes</span><span class="p">();</span> <span class="c1">// 尝试使用用默认编码</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="p">[</span><span class="o">-</span><span class="mi">42</span><span class="p">,</span> <span class="o">-</span><span class="mi">48</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">]</span>
</pre></div>


<h2 id="catch">多catch语句</h2>
<p>可以使用多个<code>catch</code>语句，每个<code>catch</code>分别捕获对应的<code>Exception</code>及其子类。JVM在捕获到异常后，会从上到下匹配<code>catch</code>语句，匹配到某个<code>catch</code>后，执行<code>catch</code>代码块，然后<em>不再</em>继续匹配。</p>
<p>简单地说就是：多个<code>catch</code>语句只有一个能被执行。例如：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">process1</span><span class="p">();</span>
        <span class="n">process2</span><span class="p">();</span>
        <span class="n">process3</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>存在多个<code>catch</code>的时候，<code>catch</code>的顺序非常重要：子类必须写在前面。例如：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">process1</span><span class="p">();</span>
        <span class="n">process2</span><span class="p">();</span>
        <span class="n">process3</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;IO error&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 永远捕获不到</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Bad encoding&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<blockquote>
<p><code>UnsupportedEncodingException</code>异常是永远捕获不到的，因为它是<code>IOException</code>的子类。当抛出<code>UnsupportedEncodingException</code>异常时，会被<code>catch (IOException e) { ... }</code>捕获并执行</p>
</blockquote>
<h2 id="finally">finally语句</h2>
<p>无论是否有异常发生，如果我们都希望执行一些语句</p>
<p>Java的<code>try ... catch</code>机制还提供了<code>finally</code>语句，<code>finally</code>语句块保证有无错误都会执行</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">process1</span><span class="p">();</span>
        <span class="n">process2</span><span class="p">();</span>
        <span class="n">process3</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">UnsupportedEncodingException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Bad encoding&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;IO error&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">finally</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;END&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>某些情况下，可以没有<code>catch</code>，只使用<code>try ... finally</code>结构。例如：</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">String</span> <span class="n">file</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span> <span class="n">finally</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;END&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="_5">捕获多种异常</h2>
<p>如果某些异常的处理逻辑相同，但是异常本身不存在继承关系，那么就得编写多条<code>catch</code>子句：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">process1</span><span class="p">();</span>
        <span class="n">process2</span><span class="p">();</span>
        <span class="n">process3</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Bad input&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Bad input&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Unknown error&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>因为处理<code>IOException</code>和<code>NumberFormatException</code>的代码是相同的，所以我们可以把它两用<code>|</code>合并到一起：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">process1</span><span class="p">();</span>
        <span class="n">process2</span><span class="p">();</span>
        <span class="n">process3</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="o">|</span> <span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IOException或NumberFormatException</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Bad input&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Unknown error&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="printstacktrace">printStackTrace() 异常调用栈</h2>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">Main</span> <span class="p">{</span>
    <span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">try</span> <span class="p">{</span>
            <span class="n">process1</span><span class="p">();</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">void</span> <span class="n">process1</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">process2</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="kt">void</span> <span class="n">process2</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="n">null</span><span class="p">);</span> <span class="c1">// 会抛出NumberFormatException</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">NumberFormatException</span><span class="o">:</span> <span class="n">null</span>
    <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">620</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">776</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">Main</span><span class="p">.</span><span class="n">process2</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">Main</span><span class="p">.</span><span class="n">process1</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">Main</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">4</span><span class="p">)</span>
</pre></div>


<blockquote>
<ol>
<li><code>main()</code>调用<code>process1()</code>；</li>
<li><code>process1()</code>调用<code>process2()</code>；</li>
<li><code>process2()</code>调用<code>Integer.parseInt(String)</code>；</li>
<li><code>Integer.parseInt(String)</code>调用<code>Integer.parseInt(String, int)</code>。</li>
</ol>
</blockquote>
<h2 id="throwablegetcause">Throwable.getCause() 获取原始异常</h2>
<p>在代码中获取原始异常可以使用<code>Throwable.getCause()</code>方法。如果返回<code>null</code>，说明已经是“根异常”了。</p>
<h1 id="throw">throw 抛出异常</h1>
<p>用<code>throw</code>语句抛出</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">process2</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NullPointerException</span> <span class="n">e</span> <span class="o">=</span> <span class="n">new</span> <span class="n">NullPointerException</span><span class="p">();</span>
        <span class="n">throw</span> <span class="n">e</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>实际上，绝大部分抛出异常的代码都会合并写成一行：</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">process2</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">==</span><span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">NullPointerException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h1 id="_6">异常屏蔽 (不常用)</h1>
<p><code>finally</code>抛出异常后，原来在<code>catch</code>中准备抛出的异常就“消失”了，因为只能抛出一个异常。没有被抛出的异常称为“被屏蔽”的异常（Suppressed Exception）</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">Main</span> <span class="p">{</span>
    <span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">try</span> <span class="p">{</span>
            <span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;catched&quot;</span><span class="p">);</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="nf">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">finally</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;finally&quot;</span><span class="p">);</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="nf">IllegalArgumentException</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">catched</span>
<span class="n">Exception</span> <span class="n">in</span> <span class="kr">thread</span> <span class="s">&quot;main&quot;</span> <span class="n">finally</span>
<span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">IllegalArgumentException</span>
    <span class="n">at</span> <span class="n">Main</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<p>绝大多数情况下，在<code>finally</code>中不要抛出异常。因此，我们通常不需要关心<code>Suppressed Exception</code>。</p>
<h2 id="_7">获知所有的异常</h2>
<p>在极少数的情况下，我们需要获知所有的异常</p>
<p>先用<code>origin</code>变量保存原始异常，然后调用<code>Throwable.addSuppressed()</code>，把原始异常添加进来，最后在<code>finally</code>抛出</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">Main</span> <span class="p">{</span>
    <span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">Exception</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
        <span class="n">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span>
            <span class="n">throw</span> <span class="n">e</span><span class="p">;</span>
        <span class="p">}</span> <span class="n">finally</span> <span class="p">{</span>
            <span class="n">Exception</span> <span class="n">e</span> <span class="o">=</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">origin</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">e</span><span class="p">.</span><span class="n">addSuppressed</span><span class="p">(</span><span class="n">origin</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">throw</span> <span class="n">e</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span>
<span class="n">Exception</span> <span class="n">in</span> <span class="kr">thread</span> <span class="s">&quot;main&quot;</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">IllegalArgumentException</span>
    <span class="n">at</span> <span class="n">Main</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">10</span><span class="p">)</span>
    <span class="nl">Suppressed:</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">NumberFormatException</span><span class="o">:</span> <span class="n">For</span> <span class="n">input</span> <span class="n">string</span><span class="o">:</span> <span class="s">&quot;abc&quot;</span>
        <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">NumberFormatException</span><span class="p">.</span><span class="n">forInputString</span><span class="p">(</span><span class="n">NumberFormatException</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">68</span><span class="p">)</span>
        <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">658</span><span class="p">)</span>
        <span class="n">at</span> <span class="n">java</span><span class="p">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">Integer</span><span class="p">.</span><span class="n">parseInt</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">776</span><span class="p">)</span>
        <span class="n">at</span> <span class="n">Main</span><span class="p">.</span><span class="n">main</span><span class="p">(</span><span class="n">Main</span><span class="p">.</span><span class="n">java</span><span class="o">:</span><span class="mi">5</span><span class="p">)</span>
</pre></div>


<h1 id="_8">自定义异常</h1>
<p>Java标准库定义的常用异常包括：</p>
<div class="hlcode"><pre><span class="n">Exception</span>
<span class="err">│</span>
<span class="err">├─</span> <span class="n">RuntimeException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">├─</span> <span class="n">NullPointerException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">├─</span> <span class="n">IndexOutOfBoundsException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">├─</span> <span class="n">SecurityException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">└─</span> <span class="n">IllegalArgumentException</span>
<span class="err">│</span>     <span class="err">│</span>
<span class="err">│</span>     <span class="err">└─</span> <span class="n">NumberFormatException</span>
<span class="err">│</span>
<span class="err">├─</span> <span class="n">IOException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">├─</span> <span class="n">UnsupportedCharsetException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">├─</span> <span class="n">FileNotFoundException</span>
<span class="err">│</span>  <span class="err">│</span>
<span class="err">│</span>  <span class="err">└─</span> <span class="n">SocketException</span>
<span class="err">│</span>
<span class="err">├─</span> <span class="n">ParseException</span>
<span class="err">│</span>
<span class="err">├─</span> <span class="n">GeneralSecurityException</span>
<span class="err">│</span>
<span class="err">├─</span> <span class="n">SQLException</span>
<span class="err">│</span>
<span class="err">└─</span> <span class="n">TimeoutException</span>
</pre></div>


<p>在代码中需要抛出异常时，尽量使用JDK已定义的异常类型</p>
<div class="hlcode"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">process1</span><span class="p">(</span><span class="kt">int</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">age</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="_9">异常继承</h2>
<p>自定义新的异常类型</p>
<p>一个常见的做法是自定义一个<code>BaseException</code>作为“根异常”，然后，派生出各种业务类型的异常。</p>
<p><code>BaseException</code>需要从一个适合的<code>Exception</code>派生，通常建议从<code>RuntimeException</code>派生：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">BaseException</span> <span class="n">extends</span> <span class="n">RuntimeException</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>


<p>其他业务类型的异常就可以从<code>BaseException</code>派生：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">UserNotFoundException</span> <span class="n">extends</span> <span class="n">BaseException</span> <span class="p">{</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">class</span> <span class="n">LoginFailedException</span> <span class="n">extends</span> <span class="n">BaseException</span> <span class="p">{</span>
<span class="p">}</span>

<span class="p">...</span>
</pre></div>


<p>自定义的<code>BaseException</code>应该提供多个构造方法：</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">BaseException</span> <span class="n">extends</span> <span class="n">RuntimeException</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">BaseException</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">super</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">BaseException</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">Throwable</span> <span class="n">cause</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">super</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">cause</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">BaseException</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">super</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">BaseException</span><span class="p">(</span><span class="n">Throwable</span> <span class="n">cause</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">super</span><span class="p">(</span><span class="n">cause</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h1 id="assertion">断言 Assertion (不常用)</h1>
<p>断言（Assertion）是一种调试程序的方式。在Java中，使用<code>assert</code>关键字来实现断言</p>
<p>实际开发中，很少使用断言。更好的方法是编写单元测试</p>
<h2 id="_10">开启</h2>
<p>JVM默认关闭断言指令，即遇到<code>assert</code>语句就自动忽略了，不执行。</p>
<p>要执行<code>assert</code>语句，必须给Java虚拟机传递<code>-enableassertions</code>（可简写为<code>-ea</code>）参数启用断言</p>
<div class="hlcode"><pre><span class="n">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">123.45</span><span class="p">);</span>
    <span class="n">assert</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<blockquote>
<p>assert x &gt;= 0;<code>即为断言，断言条件</code>x &gt;= 0<code>预期为</code>true<code>。如果计算结果为</code>false<code>，则断言失败，抛出</code>AssertionError</p>
</blockquote>
<h2 id="assertionerror">AssertionError</h2>
<p>断言失败时会抛出<code>AssertionError</code>，导致程序结束退出。因此，断言不能用于可恢复的程序错误，只应该用于开发和测试阶段</p>
<h2 id="_11">应用场景</h2>
<p>对于可恢复的程序错误，不应该使用断言。例如：</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">assert</span> <span class="n">arr</span> <span class="o">!=</span> <span class="n">null</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>应该抛出异常并在上层捕获：</p>
<div class="hlcode"><pre><span class="kt">void</span> <span class="nf">sort</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;array cannot be null&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Xu XueHua.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-01-05 13:48:06</p>
      </span>
    </div>

    
    
  </body>
</html>